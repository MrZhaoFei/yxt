<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.system.mapper.service.transfer.TransTreatRecordsInfoMapper" >
<!-- 新增 -->
	<insert id="insert" parameterType="org.system.entity.service.transfer.TransTreatRecordsInfo">
		INSERT INTO trans_treat_records_info(trans_treat_detaily_id,src_doctor_id,desc_doctor_id,trans_treat_date)
		VALUES(#{transTreatDetailyId},#{srcDoctorId},#{descDoctorId},#{transTreatDate})
	</insert>
	
	<select id="queryAll" parameterType="org.system.entity.service.transfer.TransTreatRecordsInfo" resultType="map">
		SELECT ttri.id,ttri.src_doctor_id srcDoctorId,dd.`name` srcDoctorName,ttri.desc_doctor_id descDoctorId,ps.`name` serviceName,
			dtd.`name` descDoctorName,ttri.trans_treat_date transTreatDate,ttri.trans_treat_detaily_id transTreatDetailyId,
			ttd.trans_treat_number transTreatNumber,ttd.service_resp_task_id serviceRespTaskId,
			ttd.used_count usedCount,ttd.user_service_id userServiceId,ttd.sick_time sickTime,ttd.first_diagnosis_desc firstDiagnosisDesc,ttd.jws_desc jwsDesc,
			ttd.zljg_desc zljgDesc,ttd.trans_reason transReason,ttd.hm_zdjg hmZdjg,ttd.hm_zljg hmZljg,ttd.hm_kfjy hmKfjy,ttd.hm_gjtysjy hmGjtysjy,
			ttd.status ,ttd.snapshot,ud.`name` userName,ud.contact,ps.service_type_id serviceTypeId,srt.user_id userId,u.phone,ttd.trans_date transDate,
			ps.common_field commonField,d.doctor_type_id srcDoctorTypeId,dtr.`name` srcDoctorTypeName,
			dr.doctor_type_id descDoctorTypeId,dt.`name` descDoctorTypeName,dl.doctor_level_name srcDoctorLevelName,dlr.doctor_level_name descDoctorLevelName
		FROM trans_treat_records_info ttri
		LEFT JOIN doctor_detail dd on dd.doctor_id=ttri.src_doctor_id
		LEFT JOIN doctor d on d.id=dd.doctor_id 
		LEFT JOIN doctor_detail dtd on dtd.doctor_id=ttri.desc_doctor_id
		LEFT JOIN doctor dr on dr.id=dtd.doctor_id 
		LEFT JOIN trans_treat_detaily ttd on ttri.trans_treat_detaily_id=ttd.id
		LEFT JOIN service_resp_task srt on srt.id=ttd.service_resp_task_id
		LEFT JOIN user_detail ud on ud.user_id=srt.user_id
		LEFT JOIN user u on u.id=ud.user_id
		LEFT JOIN user_service us on us.id=ttd.user_service_id
		LEFT JOIN product_service ps on ps.id=us.product_service_id
		LEFT JOIN doctor_type dtr on dtr.id=d.doctor_type_id
		LEFT JOIN doctor_type dt on dt.id=dr.doctor_type_id
		LEFT JOIN doctor_level dl on dl.id=d.doctor_level_id
		LEFT JOIN doctor_level dlr on dlr.id=dr.doctor_level_id
		where  ttd.status  in (2,4,7)
			<if test="srcDoctorId !=null ">
				and ttri.src_doctor_id=#{srcDoctorId}
			</if>
			<if test="descDoctorId !=null ">
				and ttri.desc_doctor_id=#{descDoctorId}
			</if>
			<if test="transTreatDetailyId !=null">
				and ttri.trans_treat_detaily_id=#{transTreatDetailyId}
			</if>
			<if test="serviceTypeId !=null">
				and ps.service_type_id=#{serviceTypeId}
			</if>
			<if test="status !=null">
				and ttd.status=#{status}
			</if>
			<choose>
				<when test="transTreatDate !=null and endDate !=null">
					and ttd.trans_date BETWEEN #{transTreatDate} and #{endDate}
				</when>
				<otherwise>
					<if test="transTreatDate !=null ">
						and ttd.trans_date &gt; #{transTreatDate}
					</if>
					<if test="endDate !=null ">
						and ttd.trans_date &lt; #{endDate}
					</if>
				</otherwise>
		</choose>
		order by transDate desc 
	</select>
	<select id="queryOne" parameterType="org.system.entity.service.transfer.TransTreatRecordsInfo" resultType="map">
		SELECT ttri.id,ttri.src_doctor_id srcDoctorId,dd.`name` srcDoctorName,ttri.desc_doctor_id descDoctorId,
			dtd.`name` descDoctorName,ttri.trans_treat_date transTreatDate,ttri.trans_treat_detaily_id transTreatDetailyId,
			ttd.trans_treat_number transTreatNumber,ttd.service_resp_task_id serviceRespTaskId,
			ttd.used_count usedCount,ttd.user_service_id userServiceId,ttd.sick_time sickTime,ttd.first_diagnosis_desc firstDiagnosisDesc,ttd.jws_desc jwsDesc,
			ttd.zljg_desc zljgDesc,ttd.trans_reason transReason,ttd.hm_zdjg hmZdjg,ttd.hm_zljg hmZljg,ttd.hm_kfjy hmKfjy,ttd.hm_gjtysjy hmGjtysjy,
			ttd.status ,ttd.snapshot,ud.`name` userName,ud.contact,ps.service_type_id serviceTypeId,srt.user_id userId,u.phone,ttd.trans_date transDate,
			ps.common_field commonField,d.doctor_type_id srcDoctorTypeId,dtr.`name` srcDoctorTypeName,
			dr.doctor_type_id descDoctorTypeId,dt.`name` descDoctorTypeName,dl.doctor_level_name srcDoctorLevelName,dlr.doctor_level_name descDoctorLevelName
		FROM trans_treat_records_info ttri
		LEFT JOIN doctor_detail dd on dd.doctor_id=ttri.src_doctor_id
		LEFT JOIN doctor d on d.id=dd.doctor_id 
		LEFT JOIN doctor_detail dtd on dtd.doctor_id=ttri.desc_doctor_id
		LEFT JOIN doctor dr on dr.id=dtd.doctor_id 
		LEFT JOIN trans_treat_detaily ttd on ttri.trans_treat_detaily_id=ttd.id
		LEFT JOIN service_resp_task srt on srt.id=ttd.service_resp_task_id
		LEFT JOIN user_detail ud on ud.user_id=srt.user_id
		LEFT JOIN user u on u.id=ud.user_id
		LEFT JOIN user_service us on us.id=ttd.user_service_id
		LEFT JOIN product_service ps on ps.id=us.product_service_id
				LEFT JOIN doctor_type dtr on dtr.id=d.doctor_type_id
		LEFT JOIN doctor_type dt on dt.id=dr.doctor_type_id
		LEFT JOIN doctor_level dl on dl.id=d.doctor_level_id
		LEFT JOIN doctor_level dlr on dlr.id=dr.doctor_level_id
		where ttri.id=#{id}
	</select>
	
</mapper>