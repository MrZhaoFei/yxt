<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.system.mapper.user.healthtest.UserSelfTestRecordMapper" >
	<!-- 新增 -->
	<insert id="insert" parameterType="org.system.entity.user.healthtest.UserSelfTestRecord">
		insert into user_self_test_record(user_id,title_id,result_id) values (#{userId},#{titleId},#{resultId})
	</insert>
	
	<!-- 修改 -->
	<update id="update" parameterType="org.system.entity.user.healthtest.UserSelfTestRecord">
		update user_self_test_record set id=#{id}
		<if test="userId !=null">
			,user_id=#{userId}
		</if>
		<if test="titleId !=null">
			,title_id=#{titleId}
		</if>
		<if test="resultId !=null">
			,result_id=#{resultId}
		</if>
		where id=#{id}
	</update>
	
	<!-- 查询列表 -->
	<select id="queryAll" parameterType="org.system.entity.user.healthtest.UserSelfTestRecord" resultType="map">
	select stt.id titleId,stt.name titleName,str.title result from user_self_test_record ustr 
		left join self_test_title stt on stt.id=ustr.title_id
		left join self_test_result str on str.id=ustr.result_id
		where ustr.user_id=#{userId}
	</select>
	
	<!-- 根据约束键查询数据是否存在 -->
	<select id="checkExists" parameterType="org.system.entity.user.healthtest.UserSelfTestRecord" resultType="map">
		SELECT id,user_id userId,title_id titleId,result_id resultId FROM user_self_test_record where user_id=#{userId} and title_id=#{titleId}
	</select>
</mapper>
