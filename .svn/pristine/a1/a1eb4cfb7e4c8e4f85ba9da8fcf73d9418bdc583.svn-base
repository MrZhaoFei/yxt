<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.system.mapper.service.transfer.TransTreatPhoneRecordHistoryInfoMapper" >
  <insert id="insert" parameterType="org.system.entity.service.transfer.TransTreatPhoneRecordHistoryInfo" useGeneratedKeys="true" keyProperty="id">
  	INSERT INTO `trans_treat_phone_record_history_info` (`from`, `from_doctor_id`, `to`, `to_user_id`, `start_time`, `end_time`, `record_url`, `trans_treat_detaily_id`,`record_log`)
  	 VALUES (#{from}, #{fromDoctorId}, #{to}, #{toUserId}, #{startTime}, #{endTime}, #{recordUrl}, #{transTreatDetailyId},#{recordLog})
  </insert>
  
  <update id="update" parameterType="org.system.entity.service.transfer.TransTreatPhoneRecordHistoryInfo">
  	update trans_treat_phone_record_history_info set id=#{id}
  		<if test="endTime !=null">
  			,end_time=#{endTime}
  		</if>
  		<if test="recordUrl !=null and recordUrl !=''">
  			,record_url=#{recordUrl}
  		</if>
  		<if test="recordLog !=null and recordLog !=''">
  			,record_log=#{recordLog}
  		</if>
  	where id=#{id}
  </update>
  
  <select id="queryAll" parameterType="org.system.entity.service.transfer.TransTreatPhoneRecordHistoryInfo" resultType="map">
	select ttprhi.id,ttprhi.`from`,ttprhi.`to`,ttprhi.start_time startTime,ttprhi.end_time endTime,ttprhi.record_url recordUrl,
	ttprhi.trans_treat_detaily_id transTreatDetailyId,dd.`name` doctorName,ud.`name` userName,ttprhi.record_log recordLog
	from trans_treat_phone_record_history_info ttprhi
	left join doctor_detail dd on dd.doctor_id=ttprhi.from_doctor_id
	left join user_detail ud on ud.user_id=ttprhi.to_user_id
	<where>
		<if test="fromDoctorId !=null">
			ttprhi.from_doctor_id=#{fromDoctorId}
		</if>
		<if test="toUserId !=null">
			and ttprhi.to_user_id=#{toUserId}
		</if>
		<if test="recordLog !=null and recordLog !=''">
			and ttprhi.record_log=#{recordLog}
		</if>
		<choose>
			<when test="startTime!=null and endTime!=null">
				and ttprhi.start_time between #{startTime} and #{endTime}
			</when>
			<otherwise>
				<if test="startTime!=null">
					and ttprhi.start_time &gt; #{startTime}
				</if>
				<if test="endTime!=null">
					and ttprhi.end_time &lt; #{endTime}
				</if>
			</otherwise>
		</choose>
		
	</where>
  </select>
</mapper>