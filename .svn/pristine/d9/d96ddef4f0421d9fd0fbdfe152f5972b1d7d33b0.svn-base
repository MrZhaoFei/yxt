<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head> 
  <base href="/yxt-admin/" /> 
  <title>短信模板类型列表</title> 
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /> 
   <META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
  <META HTTP-EQUIV="Cache-Control" CONTENT="no-cache"> 
   <META HTTP-EQUIV="Expires" CONTENT="0">
  <link rel="stylesheet" type="text/css" href="/yxt-admin/js/easyui/themes/icon.css" /> 
  <link rel="stylesheet" type="text/css" href="/yxt-admin/js/easyui/themes/gray/easyui.css" /> 
  <link rel="stylesheet" type="text/css" href="/yxt-admin/css/jquery.flex-images.css" /> 
  <link rel="stylesheet" type="text/css" href="/yxt-admin/css/icon/font-awesome.min.css" /> 
  <link rel="stylesheet" type="text/css" href="/yxt-admin/css/upload/webuploader.css" /> 
  <link rel="stylesheet" type="text/css" href="/yxt-admin/css/upload/style.css" /> 
  <link rel="stylesheet" type="text/css" href="/yxt-admin/css/web.css" /> 
  <script type="text/javascript" src="/yxt-admin/js/jquery.min.js"></script> 
  <script type="text/javascript" src="/yxt-admin/js/easyui/jquery.easyui.min.js"></script> 
  <script type="text/javascript" src="/yxt-admin/js/easyui/locale/easyui-lang-zh_CN.js"></script> 
  <script type="text/javascript" src="/yxt-admin/js/easyui/extend.easyui.js"></script> 
  <script type="text/javascript" src="/yxt-admin/js/jquery.flex-images.min.js"></script>
 
     
     
  <script type="text/javascript">
  $(function() {
	 
		  $('#main_table').datagrid({
			    method: 'get',
			    url: '/yxt-admin/admin/contentType?ran=' + Math.random(),
			    toolbar: '#seach',
			    pagination: true,
			    fit: true,
			    fitColumns: true,
			    border: false,
			    rownumbers: true,
			    singleSelect: true,
			    loadFilter: function(data) {
			    	if(data.stateCode=='205'){
			    		   top.location.href="/yxt-admin/adminLogin.html";
			    		return;
			    	}else if(data.stateCode=='203'){
			    		return {total:0,rows:[]};
			    	}
			      return data.data;
			    }
			  });
		  $('#main_table').datagrid('reload');
  
	});
	function query() {
	  $('#main_table').datagrid('load', {
	    name: $('#doctorTypeName').textbox('getValue')
	  });
	}

	function clear() {
	  $('#doctorTypeName').textbox('clear');

	}
	 function re(){
   	  history.go(0) 
     }
	function _opformatter(value, row, index) {
	  var a = '&nbsp;<a href="javascript:edit(\'' + index + '\',' + row.id + ')" title="编辑"><i class="fa fa-pencil"></i></a>';
	 var c = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp<a href="javascript:del(\'' + row.id + '\')" title="删除"><i class="fa fa-trash"></i></a>';
	  return a+c;
	}

	function add() {
	  $('#form').form('reset');
	  $('#password').textbox({'required': true}); 
	  $('#dialog').dialog({
	    title: '添加信息',
	    width: 400,
	    height: 220,
	    closed: false,
	    modal: true,
	    buttons: [{
	      text: '确定添加',
	      handler: function() {
	        var v = $('#form').form('validate');
	        if (v) {      	
	        	 $.ajax({
	                  type: 'POST',
	                  url: '/yxt-admin/admin/contentType/insert',
	               data: $('#form').serialize(),
	                  success: function(data) {
	                    if (data.stateCode == 200) {
	                      $('#dialog').dialog('close');
	                      $('#main_table').datagrid('reload');
	                      $.messager.show({
	                        title: '提示消息',
	                        msg: data.message,
	                        timeout: 5000,
	                        showType: 'slide'
	                      });
	                    } else {
	                      $.messager.show({
	                        title: '提示',
	                        msg: data.message
	                      });
	                    }
	                  },
	                  error: function(XMLHttpRequest, textStatus, errorThrown) {
	                    $.messager.show({
	                      title: '提示',
	                      msg: '请求发生错误请联系开发者'
	                    });
	                  }
	                });
	               
	          }
	        }
	      },
	    
	    
	    {
	      text: '取消关闭',
	      handler: function() {
	        $('#dialog').dialog('close');
	      }
	    }]
	  
	  
	  });
	
	
	}
	
	
	
	function edit(index, id) {
	 
	  $('#form').form('load', $('#main_table').datagrid('getData').rows[index]);
	  $('#password').textbox({'required': false});
  
	  $('#dialog').dialog({
	    title: '修改/查看信息',
	    width: 400,
	    height: 220,
	    closed: false,
	    modal: true,
	    buttons: [{
	      text: '确定修改',
	      handler: function() {
	        var v = $('#form').form('validate');
	        if (v) {
              //AJAX提交
              $.ajax({
                type: 'put',
                url: '/yxt-admin/admin/contentType/' + id,
                data: $('#form').serialize(),         
                success: function(data) {
                  if (data.stateCode == 200) {
                    $('#dialog').dialog('close');
                    $('#form').form('reset');
                    $('#main_table').datagrid('reload');
                    $.messager.show({
                      title: '提示消息',
                      msg: data.message,
                      timeout: 5000,
                      showType: 'slide'
                    });
                  } else {
                    $.messager.show({
                      title: '提示',
                      msg: data.message
                    });
                  }
                },
                error: function(XMLHttpRequest, textStatus, errorThrown) {
                  $.messager.show({
                    title: '提示',
                    msg: '请求发生错误请联系开发者'
                  });
                }
              });
	        }
	        
	        
	      }
	    },
	    
	    
	    {
	      text: '取消关闭',
	      handler: function() {
	        $('#dialog').dialog('close');
	      }
	    }]
	  
	  
	  
	  
	  });
	
	}
	
	function del(id) {
		  $.messager.confirm('确认', '您确认想要删除记录吗？',
		  function(r) {
			$.ajax({
				 type: 'delete',
				url:'/yxt-admin/admin/contents/'+id,
			    success:function(data){
			    	 if (data.stateCode == 200){
			    		 alert("删除成功!")
			 		    if (r) {
			 		      $.ajax({
			 		        type: 'delete',
			 		        url: '/yxt-admin/admin/contentType/' + id,
			 		        success: function(data) {
			 		          if (data.stateCode == 200) {
			 		            $('#main_table').datagrid('reload');
			 		            $.messager.show({
			 		              title: '提示消息',
			 		              msg: data.message,
			 		              timeout: 5000,
			 		              showType: 'slide'
			 		            });
			 		          } else {
			 		            $.messager.show({
			 		              title: '提示',
			 		              msg: data.message
			 		            });
			 		          }
			 		        },
			 		        error: function(XMLHttpRequest, textStatus, errorThrown) {
			 		          $.messager.show({
			 		            title: '提示',
			 		            msg: '请求发生错误请联系开发者'
			 		          });
			 		        }
			 		      });
			 		    } 
			    		 
			    		 
			    	 }else{
						  if (r) {
				 		      $.ajax({
				 		        type: 'delete',
				 		        url: '/yxt-admin/admin/contentType/' + id,
				 		        success: function(data) {
				 		          if (data.stateCode == 200) {
				 		            $('#main_table').datagrid('reload');
				 		            $.messager.show({
				 		              title: '提示消息',
				 		              msg: data.message,
				 		              timeout: 5000,
				 		              showType: 'slide'
				 		            });
				 		          } else {
				 		            $.messager.show({
				 		              title: '提示',
				 		              msg: data.message
				 		            });
				 		          }
				 		        },
				 		        error: function(XMLHttpRequest, textStatus, errorThrown) {
				 		          $.messager.show({
				 		            title: '提示',
				 		            msg: '请求发生错误请联系开发者'
				 		          });
				 		        }
				 		      });
				 		    } 
			    	 }
			    }
				
			}) 
			
			
			 
		  });
		}
	
	
</script> 
 </head> 
 <body class="easyui-layout" id="layout">
 <div id="west" data-options="region:'west',collapsible:false,split:false">
  <!-- 搜索栏 --> 
  <div id="seach"> 
   <label>模板类型名称:</label> 
   <input id="doctorTypeName" class="easyui-textbox" style="width: 120px;" /> 
   <a href="javascript:query()" class="easyui-linkbutton"><i class="fa fa-search"></i> 搜索</a> 
   <a href="javascript:clear()" class="easyui-linkbutton"><i class="fa fa-ban"></i> 清除搜索条件</a> 
   <a href="javascript:add()" class="easyui-linkbutton"><i class="fa fa-plus"></i> 新增</a>
   <a href="javascript:re()" class="easyui-linkbutton"><i class="fa  fa-refresh"></i> 刷新当前页面</a>  
  </div> 
  
  <!-- 内容表格 --> 
  <table id="main_table"> 
   <thead> 
    <tr> 
     <th data-options="field:'id',width:20">id</th>  
     <th data-options="field:'name',width:30">模板类型名称</th> 
     <th data-options="field:'remark',width:25">描述</th>     
     <th data-options="field:'img',align:'center',width:30,formatter:_opformatter">操作</th> 
    </tr> 
   </thead> 
  </table> 
  <!-- 添加 --> 
  <div id="dialog"> 
   <form id="form" method="post"> 
    <table class="table-edit" width="100%" align="center"> 
     <tbody> 
      <tr> 
       <td style="width: 110px;">模板类型名称</td> 
       <td><input class="easyui-textbox" name="name" id="name" style="width: 200px" data-options="required:true,validType:'length[0,32]' "/>
       </td> 
       </tr>
       <tr>
       <td style="width: 100px;">模板类型描述</td> 
       <td><input class="easyui-textbox" type="text"  name="remark" id="remark" style="width: 200px;height:50px"  data-options="multiline:true,validType:'length[0,128]'"/>
       </td> 
      </tr>        
     </tbody> 
    </table> 
   </form> 
  </div>
  </div> 
 </body>
</html>