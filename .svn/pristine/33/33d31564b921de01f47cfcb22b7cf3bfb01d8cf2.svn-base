<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.system.mapper.chat.WeixinRecordsHistoryInfoMapper">
	<!-- 查询列表 -->
	<select id="queryAll" parameterType="org.system.entity.chat.WeixinRecordsHistoryInfo"
		resultType="map">
		select wrhi.id,wrhi.user_id userId,wrhi.doctor_id doctorId,ud.`name`
		userName,dd.`name` doctorName,wrhi.content,wrhi.send_time
		sendTime,wrhi.message_to messageTo
		from v_weixin_records_history_info
		wrhi
		left join user_detail ud on ud.user_id=wrhi.user_id
		left join
		doctor_detail dd on dd.doctor_id=wrhi.doctor_id
		<where>
			<if test="userId !=null ">
				wrhi.user_id=#{userId}
			</if>
			<if test="doctorId !=null ">
				and wrhi.doctor_id=#{doctorId}
			</if>
			<choose>
				<when test="startDate!=null and endDate!=null">
					and wrhi.send_time BETWEEN #{startDate} and #{endDate}
				</when>
				<otherwise>
					<if test="startDate!=null">
						and wrhi.send_time &gt; #{startDate}
					</if>
					<if test="endDate!=null">
						and wrhi.send_time &lt; #{endDate}
					</if>
				</otherwise>
			</choose>
		</where>
		order by sendTime desc
	</select>
</mapper>