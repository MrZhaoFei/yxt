<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.system.mapper.user.UserHabitMapper">
<!-- 新增 -->
<insert id="insert" parameterType="org.system.entity.user.UserHabit">
	insert into user_habit(user_id,habit_id) values
	<foreach collection="habitIds" item="habitId" separator=",">
		(#{userId},#{habitId})
	</foreach>
</insert>
<!-- 检查唯一性 -->
<select id="checkExistsMany" parameterType="org.system.entity.user.UserHabit" resultType="map">
	select user_id,habit_id from user_habit where user_id=#{userId} and habit_id in 
	<foreach collection="habitIds" item="habitId" separator="," open="(" close=")">
		#{habitId}
	</foreach>
</select>
<!-- 查询列表 -->
<select id="queryAll" parameterType="org.system.entity.user.UserHabit" resultType="map">
	SELECT uf.user_id userId,ud.name userName,uf.habit_id habitId,f.name habitName FROM user_habit uf 
	left join user_detail ud on ud.user_id=uf.user_id
    left join habit f on f.id=uf.habit_id 
	<where>
		<if test="userId!=null and userId!=''">
			uf.user_id=#{userId}
		</if>
	</where>
</select>
<!-- 删除 -->
<delete id="delete" parameterType="org.system.entity.user.UserHabit">
	delete from user_habit where user_id=#{userId} and habit_id in
	<foreach collection="habitIds" item="habitId" separator="," open="(" close=")">
		#{habitId}
	</foreach>
</delete>
</mapper>