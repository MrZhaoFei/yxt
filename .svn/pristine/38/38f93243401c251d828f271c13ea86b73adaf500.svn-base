<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.system.mapper.doctor.DoctorDoctorGroupMapper">
<!--  -->
<insert id="insert" parameterType="org.system.entity.doctor.DoctorDoctorGroup" useGeneratedKeys="true" keyProperty="id">
	insert into doctor_doctor_group(role_id,doctor_id,doctor_group_id) values(#{roleId},#{doctorId},#{doctorGroupId})
</insert>

<!-- 修改 -->
<update id="update" parameterType="org.system.entity.doctor.DoctorDoctorGroup" >
 	update doctor_doctor_group set
 	<if test="roleId !=null ">
 		role_id=#{roleId}
 	</if>
 	where  doctor_group_id=#{doctorGroupId}  and  doctor_id=#{doctorId} 
</update>

<!-- 查询所有 -->
<select id="queryAll" parameterType="org.system.entity.doctor.DoctorDoctorGroup" resultType="map">
	select ddr.doctor_group_id doctorGroupId,ddr.role_id roleId,ddr.doctor_id doctorId,dd.`name` doctorName,dd.IDCard IDCard,dd.gootat gootat,r.`name` roleName   
	from doctor_doctor_group  ddr
	left join doctor_detail dd on dd.doctor_id=ddr.doctor_id
	left join role r on r.id=ddr.role_id
	<where>
		<if test="doctorId !=null ">
			 ddr.doctor_id=#{doctorId} 
		</if>
		<if test="doctorGroupId !=null ">
			and ddr.doctor_group_id=#{doctorGroupId} 
		</if>
		<if test="roleId !=null ">
			and ddr.role_id=#{roleId} 
		</if>
	</where>
</select>
<!-- 查询医生角色 权限 -->
<select id="queryOne" parameterType="org.system.entity.doctor.DoctorDoctorGroup" resultType="map">
	select ddr.doctor_group_id doctorGroupId,ddr.role_id roleId,ddr.doctor_id doctorId
  	from doctor_doctor_group  ddr where ddr.doctor_group_id=#{doctorGroupId} and ddr.doctor_id=#{doctorId}
</select>

<!-- 查询 医生是否有未完成 转诊记录  -->
<select id="getTransTreatDetaily" parameterType="org.system.entity.doctor.DoctorDoctorGroup" resultType="map">
	select ttd.id,ttd.trans_treat_number transTreatNumber,ttd.status from trans_treat_detaily  ttd 
	where  ttd.doctor_id=#{doctorId} and ttd.status not in(2,4,7) 
</select>

<!-- 查询 医生是否有未完成 影像会诊记录  -->
<select id="getImageConsultationDetaily" parameterType="org.system.entity.doctor.DoctorDoctorGroup" resultType="map">
	select icd.id,trans_treat_number transTreatNumber,icd.status from image_consultation_detaily icd 
	where icd.doctor_id=#{doctorId} and icd.status not in(2,4,6) 
</select>
<!-- 查询 医生是否有未完成服务响应  -->
<select id="getServiceRespTaskDetaily" parameterType="org.system.entity.doctor.DoctorDoctorGroup" resultType="map">
	select srt.id,srt.doctor_id doctorId,srt.task_number transTreatNumber,srt.task_status from service_resp_task srt 
	where srt.doctor_id=#{doctorId} and srt.status not in(3,4) 
</select>
<!-- 删除团队成员 -->
  <delete id="delete" parameterType="org.system.entity.doctor.DoctorDoctorGroup" >
    delete from doctor_doctor_group
    where doctor_id=#{doctorId} and doctor_group_id=#{doctorGroupId}
  </delete>

</mapper>