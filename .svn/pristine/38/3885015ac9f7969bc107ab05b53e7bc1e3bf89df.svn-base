<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.system.mapper.doctor.DoctorDoctorGroupMapper" >

	<!--新增  -->
	<insert id="insert" parameterType="org.system.entity.doctor.DoctorDoctorGroup" useGeneratedKeys="true" keyColumn="id">
	 insert into doctor_doctor_group(role_id,doctor_id,doctor_group_id) values(#{roleId},#{doctorId},#{doctorGroupId})
	</insert>
	<!-- 删除 -->
	<delete id="delete" parameterType="org.system.entity.doctor.DoctorDoctorGroup">
	delete from doctor_doctor_group
	<where>
	  <if test="doctorGroupId!=null">
	  doctor_group_id=#{doctorGroupId}
	  </if>
	  <if test="doctorId!=null">
	 and  doctor_id=#{doctorId}
	  </if>
	</where>
	</delete>
<!-- 查询所有 -->
<select id="queryAll" parameterType="org.system.entity.doctor.DoctorDoctorGroup" resultType="map">
	select ddr.doctor_group_id doctorGroupId,ddr.role_id roleId,ddr.doctor_id doctorId,dd.`name` doctorName,dd.IDCard IDCard,dd.gootat gootat,r.`name` roleName    from doctor_doctor_group  ddr
	left join doctor_detail dd on dd.doctor_id=ddr.doctor_id
	left join role r on r.id=ddr.role_id
	<where>
		<if test="doctorId !=null ">
			and doctor_id=#{doctorId} 
		</if>
		<if test="doctorGroupId !=null ">
			doctor_group_id=#{doctorGroupId} 
		</if>
		<if test="roleId !=null ">
			and role_id=#{roleId} 
		</if>
	</where>
</select>

<!-- 修改 -->
<update id="update" parameterType="org.system.entity.doctor.DoctorDoctorGroup" >
 	update doctor_doctor_group set
 	<if test="roleId !=null ">
 		role_id=#{roleId}
 	</if>
 	where  doctor_group_id=#{doctorGroupId}  and  doctor_id=#{doctorId} 
</update>

<!-- 根据约束键查询数据是否存在 -->
<select id="checkExists" parameterType="org.system.entity.doctor.DoctorDoctorGroup" resultType="map">
	select doctor_group_id doctorGroupId,role_id roleId,doctor_id doctorId   from doctor_doctor_group 
	<where>
		<if test="doctorGroupId !=null ">
			doctor_group_id=#{doctorGroupId} 
		</if>
		<if test="roleId !=null ">
			and role_id=#{roleId} 
		</if>
		<if test="doctorId !=null ">
			and doctor_id=#{doctorId} 
		</if>
	</where>
</select>

	<!-- 判断团队长只有一个  -->
	<select id="queryOneTeamer" parameterType="org.system.entity.doctor.DoctorDoctorGroup" resultType="int">
	    select count(role_id)  from doctor_doctor_group  where doctor_group_id=#{doctorGroupId}   and role_id=1
	</select>

	<!--医生团队 医生关系表       doctor_group_id  and doctor_id 不能重复-->
	<select id="queryOneDoctorGroup" parameterType="org.system.entity.doctor.DoctorDoctorGroup" resultType="int">
	    select count(doctor_id)  from doctor_doctor_group  where doctor_group_id=#{doctorGroupId}  and doctor_id =#{doctorId}
	</select>
	
	
	<!-- 该医生是否存在有团队 -->
	<select id="queryOneDoctorExistsGroup" parameterType="org.system.entity.doctor.DoctorDoctorGroup" resultType="int">
	    select count(doctor_id)  from doctor_doctor_group  where  doctor_id =#{doctorId}
	</select>
	
	
	
	
	

</mapper>