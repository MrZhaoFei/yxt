<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.system.mapper.service.visits.GxyFollowupRecordsMapper" >

  <!-- 新增 -->
  <insert id="insert" parameterType="org.system.entity.service.visits.GxyFollowupRecords" useGeneratedKeys="true" keyProperty="id">
    insert into gxy_followup_records ( user_id,service_resp_task_id, yljgbm, 
      jkdabh, sfjlbh, gxyglkbh, 
      sffsbm, sfzgztbm, sfyybm, 
      wxfcbm, gxyglfz, dzzqk, 
      mqzzbm, fywzlcs, fyycx, 
      bglfyyy, bfyyy, szy, 
      ssy, sg, tz, ydfssm, 
      ydplbm, ydsc, xl, yxtz, 
      rxyl, ryjl, sylfj, 
      sfyshlxpj, xltzpjjg, sfzyxwpjjg, 
      ywblfy, ywblfyms, bfzqkbm, 
      sfjsjkjy, jkcfjybm, jkcfjyhzjscd, 
      sfpjjgbm, sfysbh, sfysxm, 
      sfrq, xcsfrq, sftdbh, sftdmc, 
      zzyy, zryljgmc, zryljgks, 
      zfbz, update_time,doc_state,mbrxyl,mbryjl,mbydpl,mbydsc,user_service_id)
    values ( #{userId},#{serviceRespTaskId}, #{yljgbm}, 
      #{jkdabh}, #{sfjlbh}, #{gxyglkbh}, 
      #{sffsbm}, #{sfzgztbm}, #{sfyybm}, 
      #{wxfcbm}, #{gxyglfz}, #{dzzqk}, 
      #{mqzzbm}, #{fywzlcs}, #{fyycx}, 
      #{bglfyyy}, #{bfyyy}, #{szy}, 
      #{ssy}, #{sg}, #{tz}, #{ydfssm}, 
      #{ydplbm}, #{ydsc}, #{xl}, #{yxtz}, 
      #{rxyl}, #{ryjl}, #{sylfj}, 
      #{sfyshlxpj}, #{xltzpjjg}, #{sfzyxwpjjg}, 
      #{ywblfy}, #{ywblfyms}, #{bfzqkbm}, 
      #{sfjsjkjy}, #{jkcfjybm}, #{jkcfjyhzjscd}, 
      #{sfpjjgbm}, #{sfysbh}, #{sfysxm}, 
      #{sfrq}, #{xcsfrq}, #{sftdbh}, #{sftdmc}, 
      #{zzyy}, #{zryljgmc}, #{zryljgks}, 
      #{zfbz}, #{updateTime},#{docState},#{mbrxyl},#{mbryjl},#{mbydpl},#{mbydsc},#{userServiceId})
  </insert>
  <update id="update" parameterType="org.system.entity.service.visits.GxyFollowupRecords" >
    update gxy_followup_records set id=#{id}
    <if test="userId !=null">
    	,user_id = #{userId}
    </if>
    <if test="serviceRespTaskId !=null">
    	,service_resp_task_id = #{serviceRespTaskId}
    </if>
    <if test="yljgbm !=null and yljgbm !=''">
      	,yljgbm = #{yljgbm}
    </if>
    <if test="jkdabh !=null and jkdabh !=''">
      	,jkdabh = #{jkdabh}
    </if>
    <if test="sfjlbh !=null and sfjlbh !=''">
      	,sfjlbh = #{sfjlbh}
    </if>
    <if test="gxyglkbh !=null and gxyglkbh !=''">
      	,gxyglkbh = #{gxyglkbh}
    </if>
    <if test="sffsbm !=null and sffsbm !=''">
      	,sffsbm = #{sffsbm}
    </if>
    <if test="sfzgztbm !=null and sfzgztbm !=''">
      	,sfzgztbm = #{sfzgztbm}
    </if>
    <if test="sfyybm !=null and sfyybm !=''">
      	,sfyybm = #{sfyybm}
    </if>
    <if test="wxfcbm !=null and wxfcbm !=''">
      	,wxfcbm = #{wxfcbm}
    </if>
    <if test="gxyglfz !=null and gxyglfz !=''">
      	,gxyglfz = #{gxyglfz}
    </if>
    <if test="dzzqk !=null and dzzqk !=''">
      	,dzzqk = #{dzzqk}
    </if>
    <if test="mqzzbm !=null and mqzzbm !=''">
      	,mqzzbm = #{mqzzbm}
    </if>
    <if test="fywzlcs !=null and fywzlcs !=''">
      	,fywzlcs = #{fywzlcs}
    </if>
    <if test="fyycx !=null and fyycx !=''">
      	,fyycx = #{fyycx}
    </if>
    <if test="bglfyyy !=null and bglfyyy !=''">
      	,bglfyyy = #{bglfyyy}
    </if>
    <if test="bfyyy !=null and bfyyy !=''">
      	,bfyyy = #{bfyyy}
    </if>
    <if test="szy !=null">
      	,szy = #{szy}
    </if>
    <if test="ssy !=null">
      	,ssy = #{ssy}
    </if>
    <if test="sg !=null">
      	,sg = #{sg}
    </if>
    <if test="tz !=null">
      	,tz = #{tz}
    </if>
    <if test="ydfssm !=null and ydfssm!=''">
      	,ydfssm = #{ydfssm}
    </if>
    <if test="ydplbm !=null and ydplbm !=''">
      	,ydplbm = #{ydplbm}
    </if>
    <if test="ydsc !=null and ydsc !=''">
      	,ydsc = #{ydsc}
    </if>
    <if test="xl !=null and xl !=''">
      	,xl = #{xl}
    </if>
    <if test="yxtz !=null and yxtz !=''">
      	,yxtz = #{yxtz}
    </if>
    <if test="rxyl !=null and rxyl !=''">
      	,rxyl = #{rxyl}
    </if>
    <if test="ryjl !=null and ryjl !=''">
      	,ryjl = #{ryjl}
    </if>
    <if test="sylfj !=null and sylfj !=''">
      	,sylfj = #{sylfj}
    </if>
    <if test="sfyshlxpj !=null and sfyshlxpj !=''">
      	,sfyshlxpj = #{sfyshlxpj}
    </if>
    <if test="xltzpjjg !=null and xltzpjjg !=''">
      	,xltzpjjg = #{xltzpjjg}
    </if>
    <if test="sfzyxwpjjg !=null and sfzyxwpjjg !=''">
      	,sfzyxwpjjg = #{sfzyxwpjjg}
    </if>
    <if test="ywblfy !=null and ywblfy !=''">
      	,ywblfy = #{ywblfy}
    </if>
    <if test="ywblfyms !=null and ywblfyms !=''">
      	,ywblfyms = #{ywblfyms}
    </if>
    <if test="bfzqkbm !=null and bfzqkbm !=''">
      	,bfzqkbm = #{bfzqkbm}
    </if>
    <if test="sfjsjkjy !=null and sfjsjkjy !=''">
      	,sfjsjkjy = #{sfjsjkjy}
    </if>
    <if test="jkcfjybm !=null and jkcfjybm !=''">
      	,jkcfjybm = #{jkcfjybm}
    </if>
    <if test="jkcfjyhzjscd !=null and jkcfjyhzjscd !=''">
      	,jkcfjyhzjscd = #{jkcfjyhzjscd}
    </if>
    <if test="sfpjjgbm !=null and sfpjjgbm !=''">
      	,sfpjjgbm = #{sfpjjgbm}
    </if>
    <if test="sfysbh !=null and sfysbh !=''">
      	,sfysbh = #{sfysbh}
    </if>
    <if test="sfysxm !=null and sfysxm !=''">
      	,sfysxm = #{sfysxm}
    </if>
    <if test="sfrq !=null ">
      	,sfrq = #{sfrq}
    </if>
    <if test="xcsfrq !=null ">
      	,xcsfrq = #{xcsfrq}
    </if>
    <if test="sftdbh !=null and sftdbh !=''">
      	,sftdbh = #{sftdbh}
    </if>
    <if test="sftdmc !=null and sftdmc !=''">
      	,sftdmc = #{sftdmc}
    </if>
    <if test="zzyy !=null and zzyy !=''">
      	,zzyy = #{zzyy}
    </if>
    <if test="zryljgmc !=null and zryljgmc !=''">
      	,zryljgmc = #{zryljgmc}
    </if>
    <if test="zryljgks !=null and zryljgks !=''">
      	,zryljgks = #{zryljgks}
    </if>
    <if test="zfbz !=null and zfbz !=''">
      	,zfbz = #{zfbz}
    </if>
    <if test="docState !=null ">
      	,doc_state = #{docState}
    </if>
    <if test="mbrxyl !=null and mbrxyl !=''">
      	,mbrxyl = #{mbrxyl}
    </if>
    <if test="mbryjl !=null and mbryjl !=''">
      	,mbryjl = #{mbryjl}
    </if>
    <if test="mbydpl !=null and mbydpl !=''">
      	,mbydpl = #{mbydpl}
    </if>
    <if test="mbydsc !=null and mbydsc !=''">
      	,mbydsc = #{mbydsc}
    </if>
    <if test="updateTime !=null ">
      	,update_time = #{updateTime}
    </if>
    where id = #{id}
  </update>
  <!-- 查询高血压患者随访记录详情 -->
  <select id="queryOne" parameterType="org.system.entity.service.visits.GxyFollowupRecords" resultMap="gxyFollowupDragRecordsMap">
    select gfr.id,gfr.user_id,gfr.yljgbm,fn_print_hospital_name_result(gfr.yljgbm) yljgbmName,hi.jkdabh,hi.yxt_jkdabh yxtJkdabh,gfr.sfjlbh,gfr.gxyglkbh,gfr.sffsbm,fn_print_sys_code_result(gfr.sffsbm,';','CV06.00.207') sffsdmName,
    gfr.sfzgztbm,fn_print_sys_code_result(gfr.sfzgztbm,';','sfzgztbm') sfzgztbmName,gfr.sfyybm,fn_print_sys_code_result(gfr.sfyybm,';','sfyybm') sfyybmName, 
    gfr.wxfcbm, fn_print_sys_code_result(gfr.wxfcbm,';','wxfcbm') wxfcbmName,gfr.gxyglfz,fn_print_sys_code_result(gfr.gxyglfz,';','gxyglfz') gxyglfzName,
	gfr.dzzqk,fn_print_sys_code_result(gfr.dzzqk,';','dzzqk') dzzqkName,gfr.mqzzbm, fn_print_sys_code_result(gfr.mqzzbm,';','mqzzbm') mqzzbmName,
	gfr.fywzlcs, fn_print_sys_code_result(gfr.fywzlcs,';','fywzlcs') fywzlcsName,gfr.fyycx,fn_print_sys_code_result(gfr.fyycx,';','fyycx') fyycxName,
	gfr.bglfyyy,fn_print_sys_code_result(gfr.bglfyyy,';','bglfyyy') bglfyyyName,gfr.bfyyy,fn_print_sys_code_result(gfr.bfyyy,';','bfyyy') bfyyyName,
	gfr.szy, gfr.ssy, gfr.sg, gfr.tz, gfr.ydfssm, gfr.ydplbm,fn_print_sys_code_result(gfr.ydplbm,';','CV03.00.111') ydplbmName,
	gfr.ydsc,gfr.xl, gfr.yxtz,gfr.rxyl,gfr.ryjl,gfr.sylfj,gfr.sfyshlxpj,gfr.xltzpjjg,gfr.sfzyxwpjjg,gfr.ywblfy, gfr.ywblfyms, 
	gfr.bfzqkbm, fn_print_sys_code_result(gfr.bfzqkbm,';','bfzqkbm') bfzqkbmName,gfr.sfjsjkjy, gfr.jkcfjybm, fn_print_sys_code_result(gfr.jkcfjybm,';','jkcfjybm') jkcfjybmName,
	gfr.jkcfjyhzjscd,gfr.sfpjjgbm, fn_print_sys_code_result(gfr.sfpjjgbm,';','CV05.10.012') sfpjjgbmName,gfr.sfysbh, gfr.sfysxm, 
	gfr.sfrq, gfr.xcsfrq, gfr.sftdbh,gfr.sftdmc, gfr.zzyy, gfr.zryljgmc, gfr.zryljgks, gfr.zfbz, 
	gfr.update_time updateTime,gfr.service_resp_task_id serviceRespTaskId,gfr.doc_state docState,gfr.mbrxyl,gfr.mbryjl,gfr.mbydpl,
	fn_print_sys_code_result(gfr.mbydpl,';','CV03.00.111') mbydplName,gfr.mbydsc
	from gxy_followup_records gfr
  	left join service_resp_task srt on srt.id=gfr.service_resp_task_id
	left join health_info hi on hi.user_id=gfr.user_id
    where gfr.id = #{id}
    <if test="serviceRespTask !=null ">
    	<if test="serviceRespTask.doctorId !=null ">
    			and srt.doctor_id=#{serviceRespTask.doctorId}
    	</if>
	</if>
  </select>
  
  	<resultMap type="map" id="gxyFollowupDragRecordsMap">
		<result property="id" column="id" />
		<collection property="gxyFollowupDragRecordsDetail" column="id" javaType="list" select="getGxyFollowupDragRecords"/>
		 <collection property="gxyFollowupFzcheckRecordsDetail" column="id" javaType="list" select="getGxyFollowupFzcheckRecords"/> 
	</resultMap>
	
	<!-- 查询高血压患者随访记录列表 -->
	<select id="queryAll" parameterType="org.system.entity.service.visits.GxyFollowupRecords" resultType="map" >
  select gfr.id, gfr.user_id userId,gfr.yljgbm,fn_print_hospital_name_result(gfr.yljgbm) yljgbmName, hi.jkdabh,hi.yxt_jkdabh yxtJkdabh,gfr.sfjlbh,gfr.gxyglkbh,gfr.sffsbm,fn_print_sys_code_result(gfr.sffsbm,';','CV06.00.207') sffsdmName,
		gfr.sfzgztbm,fn_print_sys_code_result(gfr.sfzgztbm,';','sfzgztbm') sfzgztbmName,gfr.sfyybm,fn_print_sys_code_result(gfr.sfyybm,';','sfyybm') sfyybmName,
		gfr.wxfcbm, fn_print_sys_code_result(gfr.wxfcbm,';','wxfcbm') wxfcbmName,gfr.gxyglfz,fn_print_sys_code_result(gfr.gxyglfz,';','gxyglfz') gxyglfzName,
		gfr.dzzqk, fn_print_sys_code_result(gfr.dzzqk,';','dzzqk') dzzqkName,gfr.mqzzbm, fn_print_sys_code_result(gfr.mqzzbm,';','mqzzbm') mqzzbmName,
		gfr.fywzlcs,fn_print_sys_code_result(gfr.fywzlcs,';','fywzlcs') fywzlcsName,gfr.fyycx,fn_print_sys_code_result(gfr.fyycx,';','fyycx') fyycxName,
		gfr.bglfyyy,fn_print_sys_code_result(gfr.bglfyyy,';','bglfyyy') bglfyyyName,gfr.bfyyy,fn_print_sys_code_result(gfr.bfyyy,';','bfyyy') bfyyyName,
		gfr.szy,gfr.ssy,gfr.sg,gfr.tz,gfr.ydfssm,gfr.ydplbm,fn_print_sys_code_result(gfr.ydplbm,';','CV03.00.111') ydplbmName,gfr.ydsc,gfr.xl,gfr.yxtz,gfr.rxyl,
		gfr.ryjl,gfr.sylfj,gfr.sfyshlxpj,gfr.xltzpjjg,gfr.sfzyxwpjjg,gfr.ywblfy,gfr.ywblfyms,gfr.bfzqkbm,fn_print_sys_code_result(gfr.bfzqkbm,';','bfzqkbm') bfzqkbmName,
		gfr.sfjsjkjy,gfr.jkcfjybm,fn_print_sys_code_result(gfr.jkcfjybm,';','jkcfjybm') jkcfjybmName,gfr.jkcfjyhzjscd,gfr.sfpjjgbm, fn_print_sys_code_result(gfr.sfpjjgbm,';','CV05.10.012') sfpjjgbmName,
		gfr.sfysbh,gfr.sfysxm, gfr.sfrq, gfr.xcsfrq,gfr.sftdbh,gfr.sftdmc, gfr.zzyy, gfr.zryljgmc,gfr.zryljgks, gfr.zfbz, gfr.update_time updateTime,gfr.doc_state docState,	
		srt.task_number taskNumber,ud.`name` userName,ud.contact,ud.id_card idCard,ud.sex,u.phone,gfr.mbrxyl,gfr.mbryjl,gfr.mbydpl,
	fn_print_sys_code_result(gfr.mbydpl,';','CV03.00.111') mbydplName,gfr.mbydsc
	  from gxy_followup_records gfr
	  left join service_resp_task srt on srt.id=gfr.service_resp_task_id
	  left join user_detail ud on ud.user_id=gfr.user_id
	  left join user u on u.id=ud.user_id
	  left join health_info hi on hi.user_id=gfr.user_id
	    <where>
	    	<if test="serviceRespTask !=null ">
		    	<if test="serviceRespTask.doctorId !=null ">
		    			srt.doctor_id=#{serviceRespTask.doctorId}
		    	</if>
	    	</if>
	    	<if test="serviceRespTaskId!=null ">
	    			and gfr.service_resp_task_id=#{serviceRespTaskId}
	    	</if>
	    	<if test="user !=null ">
		    	<if test="user.phone !=null and  user.phone !=''">
		    			and u.phone like CONCAT(CONCAT('%', #{user.phone}), '%')
		    	</if>
	    	</if>
	    	<if test="userDetail !=null ">
		    	<if test="userDetail.name !=null and  userDetail.name !=''">
		    			and ud.name like CONCAT(CONCAT('%', #{userDetail.name}), '%')
		    	</if>
		    	<if test="userDetail.contact !=null and userDetail.contact !=''">
		    			and ud.contact like CONCAT(CONCAT('%', #{userDetail.contact}), '%')
		    	</if>
		    	<if test="userDetail.idcard !=null and userDetail.idcard !=''">
		    			and ud.id_card like CONCAT(CONCAT('%', #{userDetail.idcard}), '%')
		    	</if>
	    	</if>
	    	<if test="userId !=null ">
	    			and gfr.user_id =#{userId}
	    	</if>
	    	<choose>
				<when test="sfrq !=null and endSfrq !=null">
	    			and gfr.sfrq BETWEEN #{sfrq} and #{endSfrq}
				</when>
				<otherwise>
					<if test="sfrq !=null">
						and gfr.sfrq &gt; #{sfrq}
					</if>
					<if test="endSfrq !=null">
						and gfr.sfrq &lt; #{endSfrq}
					</if>
				</otherwise>
			</choose>
	    </where>
	</select>
  	<!-- 查询高血压随访用药情况 -->
	<select id="getGxyFollowupDragRecords" parameterType="org.system.entity.service.visits.GxyFollowupRecords" resultType="map">
		select gfdr.id gxyFollowupDragRecordsId,gfr.yljgbm,fn_print_hospital_name_result(gfr.yljgbm) yljgbmName,gfdr.sfjlbh gxyFollowupDragRecordsSfjlbh,gfdr.jkdabh gxyFollowupDragRecordsJkdabh,
		gfdr.yybh,gfdr.ypbm,gfdr.ypmc,gfdr.yplb,gfdr.mcyl,gfdr.yldw,gfdr.zl,gfdr.zldw,gfdr.yytjdm,fn_print_sys_code_result(gfdr.yytjdm,';','CV06.00.102') yytjdmName,
		gfdr.yypc,gfdr.zylbdm,fn_print_sys_code_result(gfdr.zylbdm,';','CV06.00.101') zylbdmName,gfdr.klrq,gfdr.zfbz gxyFollowupDragRecordsZfbz,
		gfdr.update_time gxyFollowupDragRecordsUpdateTime,gfdr.gxy_followup_records_id gfdrgxyFollowupRecordsId
		from gxy_followup_drag_records gfdr
		left join gxy_followup_records gfr on gfr.id=gfdr.gxy_followup_records_id
		where gfdr.gxy_followup_records_id=#{id}	  
	</select>
	
  	<!-- 查询高血压随访辅助检查 -->
	<select id="getGxyFollowupFzcheckRecords" parameterType="org.system.entity.service.visits.GxyFollowupRecords" resultType="map">
	    select gffr.id gxyFollowupFzcheckRecordsId,gfr.yljgbm gxyFollowupFzcheckRecordsYljgbm,fn_print_hospital_name_result(gfr.yljgbm) yljgbmName,gffr.sfjlbh gxyFollowupFzcheckRecordsSfjlbh,
	    gffr.jkdabh gxyFollowupFzcheckRecordsJkdabh,gffr.jcbh,gffr.fzjcxm,gffr.fzjcjg,gffr.jcrybh,gffr.jcryxm,gffr.jcrq,gffr.jcjgdm,gffr.jcjgmc,
	    gffr.zfbz gxyFollowupFzcheckRecordsZfbz,gffr.update_time gxyFollowupFzcheckRecordsUpdateTime,gffr.gxy_followup_records_id gffrGxyFollowupRecordsId
	    from  gxy_followup_fzcheck_records gffr
	    left join gxy_followup_records gfr on gfr.id=gffr.gxy_followup_records_id
		where gffr.gxy_followup_records_id=#{id}
	</select>
</mapper>