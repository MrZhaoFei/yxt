<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.system.mapper.chat.WeixinRecordsMapper" >
	<!-- 新增 -->
	<insert id="insert" parameterType="org.system.entity.chat.WeixinRecords">
		insert into weixin_records(doctor_id,user_id,message_to,content,attachment_url,send_time)
		values(#{doctorId},#{userId},#{messageTo},#{content},#{attachmentUrl},#{sendTime})
	</insert>
	
	<!-- 删除 -->
	<delete id="delete" parameterType="org.system.entity.chat.WeixinRecords">
		delete from weixin_records where id in
		<foreach collection="list" item="id" open="(" close=")" separator=",">
			#{id}
		</foreach>
	</delete>
	
	<!-- 删除 -->
	<delete id="deleteWeiXinRecordsByQuery" parameterType="list">
		delete from weixin_records where id in
		<foreach collection="list" item="id" open="(" close=")" separator=",">
			#{id}
		</foreach>
	</delete>
	
	<!-- 查询列表 -->
	<select id="queryAll" parameterType="org.system.entity.chat.WeixinRecords" resultType="map">
		select wr.id,wr.content,wr.message_to messageTo,wr.send_time sendTime,ud.`name` userName,d.`name` doctorName,wr.message_type type from weixin_records wr 
		left join doctor d on d.id=wr.doctor_id
		left join user_detail ud on ud.user_id=wr.user_id
		<where>
			<if test="userId !=null ">
				wr.user_id=#{userId}
			</if>
			<if test="doctorId !=null ">
				and wr.doctor_id=#{doctorId}
			</if>
			<if test="messageTo !=null ">
				and wr.message_to=#{messageTo}
			</if>
		</where>
	</select>
	<!-- 查询列表 用户查询医生 -->
	<select id="getWeixinRecordsListByUser" parameterType="org.system.entity.chat.WeixinRecords" resultType="map">
		select d.id doctorId,d.`name` doctorName,count(d.id) total from weixin_records wr 
		left join doctor d on d.id=wr.doctor_id
		<where>
			<if test="userId !=null ">
				wr.user_id=#{userId}
			</if>
			<if test="doctorId !=null ">
				and wr.doctor_id=#{doctorId}
			</if>
			<if test="messageTo !=null ">
				and wr.message_to=#{messageTo}
			</if>
		</where>
		 group by doctorId
	</select>
	<!-- 查询列表 医生查询用户 -->
	<select id="getWeixinRecordsListByDoctor" parameterType="org.system.entity.chat.WeixinRecords" resultType="map">
		select wr.user_id userId,ud.`name` userName,count(wr.user_id) total from weixin_records wr 
		left join user_detail ud on ud.user_id=wr.user_id
		<where>
			<if test="userId !=null ">
				wr.user_id=#{userId}
			</if>
			<if test="doctorId !=null ">
				and wr.doctor_id=#{doctorId}
			</if>
			<if test="messageTo !=null ">
				and wr.message_to=#{messageTo}
			</if>
		</where>
		 group by userId
	</select>
</mapper>