<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head> 
  <base href="/yxt-admin/" /> 
  <title>模板文档列表</title> 
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /> 
   <META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
  <META HTTP-EQUIV="Cache-Control" CONTENT="no-cache"> 
   <META HTTP-EQUIV="Expires" CONTENT="0">
  <link rel="stylesheet" type="text/css" href="/yxt-admin/js/easyui/themes/icon.css?ver=1001" /> 
  <link rel="stylesheet" type="text/css" href="/yxt-admin/js/easyui/themes/gray/easyui.css?ver=1001" /> 
  <link rel="stylesheet" type="text/css" href="/yxt-admin/css/jquery.flex-images.css?ver=1001" /> 
  <link rel="stylesheet" type="text/css" href="/yxt-admin/css/icon/font-awesome.min.css?ver=1001" /> 
  <link rel="stylesheet" type="text/css" href="/yxt-admin/css/upload/webuploader.css?ver=1001" /> 
  <link rel="stylesheet" type="text/css" href="/yxt-admin/css/upload/style.css?ver=1001" /> 
  <link rel="stylesheet" type="text/css" href="/yxt-admin/css/web.css?ver=1001" /> 
  <script type="text/javascript" src="/yxt-admin/js/jquery.min.js?ver=1001"></script> 
  <script type="text/javascript" src="/yxt-admin/js/easyui/jquery.easyui.min.js?ver=1001"></script> 
  <script type="text/javascript" src="/yxt-admin/js/easyui/locale/easyui-lang-zh_CN.js?ver=1001"></script> 
  <script type="text/javascript" src="/yxt-admin/js/easyui/extend.easyui.js?ver=1001"></script> 
  <script type="text/javascript" src="/yxt-admin/js/jquery.flex-images.min.js?ver=1001"></script> 
   <link href="/yxt-admin/umeditor1_2_2-utf8-net/themes/default/css/umeditor.css?ver=1001" type="text/css" rel="stylesheet">
    <script type="text/javascript" charset="utf-8" src="/yxt-admin/umeditor1_2_2-utf8-net/umeditor.config.js?ver=1001"></script>
    <script type="text/javascript" charset="utf-8" src="/yxt-admin/umeditor1_2_2-utf8-net/umeditor.min.js?ver=1001"></script>
    <script type="text/javascript" src="/yxt-admin/umeditor1_2_2-utf8-net/lang/zh-cn/zh-cn.js?ver=1001"></script>
  <script type="text/javascript">
  var heightnum="";
  $(function() {
	  heightnum=document.body.clientHeight;
	  // 初始化控件 
	  $('#main_table').datagrid({
	    method: 'get',
	    url: '/yxt-admin/admin/docTmplates?ran=' + Math.random(),
	    toolbar: '#seach',
	    pagination: true,
	    fit: true,
	    pageSize:20,
	    fitColumns: true,
	    border: false,
	    rownumbers: true,
	    singleSelect: true,
	    loadFilter: function(data) {
	    	if(data.stateCode=='205'){
	    		   top.location.href="/yxt-admin/adminLogin.html";
	    		return;
	    	}else if(data.stateCode=='203'){
	    		return {total:0,rows:[]};
	    	}
	      return data.data;
	    },
	  });
	});
  
  
  
  
	function query() {
	  $('#main_table').datagrid('load', {
		  docTitle: $('#name').textbox('getValue'),
	   
	  });
	}
	

	function clear() {
	  $('#name').textbox('clear');
	}
	
	 function re(){
   	  history.go(0) 
     }
	
	function _sexformatter(value, row, index) {
	  if (value == 1) {
	    return "异常";
	  }if (value == 0){
	  return "正常";
		  
	  }
	}
	
	function _opformatter(value, row, index) {
	  var a = '&nbsp;<a href="javascript:edit(\'' + index + '\',' + row.id + ')" title="编辑"><i class="fa fa-pencil"></i></a>';
	  var c = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp<a href="javascript:del(\'' + row.id + '\')" title="删除"><i class="fa fa-trash"></i></a>';
	  var b = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp<a href="javascript:look(\'' + row.id + '\')" title="查看"><i class="fa fa-search-plus"></i></a>';
	  return a+c+b;
	}
	
	
	
	
	function add() {
	 $("#form .easyui-textbox").textbox({ disabled: false });
	  UM.getEditor('docContent').setEnabled();
	$('#doctorLevelName').textbox('readonly',false);
	um.setContent("");
	  $('#form').form('reset');
	  $('#dialog').dialog({
	    title: '添加信息',
	    width: 1150,
	    height: 540,
	    closed: false,
	    modal: true,
	    buttons: [{
	      text: '确定添加',
	      handler: function() {
	        var v = $('#form').form('validate');	      
	        var arr = [];
	        arr.push(UM.getEditor('docContent').getPlainTxt());
	        arr=arr.join("\n");
	        if (v) {      	
	        	 $.ajax({
	                  type: 'POST',
	                  url: '/yxt-admin/admin/docTmplate',
	                data:{
	                	docTitle:$('#docTitle').textbox('getValue'),
	                	docDesc:$('#docDesc').textbox('getValue'),
	                	docContent:arr
	                },
	                  success: function(data) {
	                    if (data.stateCode == 200) {
	                    	
	                	    	 if( um.queryCommandState( 'source' )==1){
	                	 	    	 um.execCommand( 'source');	 
	                	 	    	}
	                	    
	                      $('#dialog').dialog('close');
	                      $('#main_table').datagrid('reload');
	                      $.messager.show({
	                        title: '提示消息',
	                        msg: data.message,
	                        timeout: 5000,
	                        showType: 'slide'
	                      });
	                    } else {
	                      $.messager.show({
	                        title: '提示',
	                        msg: data.message
	                      });
	                    }
	                  },
	                  error: function(XMLHttpRequest, textStatus, errorThrown) {
	                    $.messager.show({
	                      title: '提示',
	                      msg: '请求发生错误请联系开发者'
	                    });
	                  }
	                });
	               
	          }
	        }
	      },
	    
	    
	    {
	      text: '取消关闭',
	      handler: function() {
	    
	 	    	 if( um.queryCommandState( 'source' )==1){
	 	 	    	 um.execCommand( 'source');	 
	 	 	    	}
	 	   
	        $('#dialog').dialog('close');
	      }
	    }],
	    onClose:function(){
	    	 if( um.queryCommandState( 'source' )==1){
	 	    	 um.execCommand( 'source');	 
	 	    	}
	    }
	  
	  
	  });
	
	
	}
	
	
	
	function edit(index, id) {
		 $("#form .easyui-textbox").textbox({ disabled: false });
		  UM.getEditor('docContent').setEnabled();
	     
	 $('#form').form('reset');
	  $('#form').form('load', $('#main_table').datagrid('getData').rows[index]);
	  $('#doctorLevelName').textbox('readonly');
	  $.get('/yxt-admin/admin/docTmplate/' + id,function(data){
		  $('#form').form('load', {
			docTitle:data.data.docTitle,
          	docDesc:data.data.docDesc,
          	docContent:data.data.docContent
		  });
		  UM.getEditor('docContent').setContent(data.data.docContent);
	  });
	  $('#dialog').dialog({
	    title: '修改/查看信息',
	    width: 1150,
	    height: heightnum>700 ? 700:heightnum-100,
	    closed: false,
	    modal: true,
	    buttons: [{
	      text: '确定修改',
	      handler: function() {
	        var v = $('#form').form('validate');
	        var arr = [];
	        arr.push(UM.getEditor('docContent').getContent());
	        arr=arr.join("\n");
	        if (v) {
              //AJAX提交
              $.ajax({
                type: 'put',
                url: '/yxt-admin/admin/docTmplate/' + id,
                data:{
                	docTitle:$('#docTitle').textbox('getValue'),
                	docDesc:$('#docDesc').textbox('getValue'),
                	docContent:arr
                },
                success: function(data) {
                  if (data.stateCode == 200) {
                	  if( um.queryCommandState( 'source' )==1){
         	 	    	 um.execCommand( 'source');	 
         	 	    	}
                    $('#dialog').dialog('close');
                    $('#form').form('reset');
                    $('#main_table').datagrid('reload');
                    $.messager.show({
                      title: '提示消息',
                      msg: data.message,
                      timeout: 5000,
                      showType: 'slide'
                    });
                  } else {
                    $.messager.show({
                      title: '提示',
                      msg: data.message
                    });
                  }
                },
                error: function(XMLHttpRequest, textStatus, errorThrown) {
                  $.messager.show({
                    title: '提示',
                    msg: '请求发生错误请联系开发者'
                  });
                }
              });
	        }
	        
	        
	      }
	    },
	    {
	      text: '取消关闭',
	      handler: function() {
	    	  if( um.queryCommandState( 'source' )==1){
		 	    	 um.execCommand( 'source');	 
		 	    	}
	        $('#dialog').dialog('close');
	      }
	    }],
	    onClose:function(){
	    	 if( um.queryCommandState( 'source' )==1){
	 	    	 um.execCommand( 'source');	 
	 	    	}
	    }
	  
	  
	  
	  
	  });
	
	}
	
 function look(id){
	 $('#form').form('reset');
	 $("#form .easyui-textbox").textbox({ disabled: true });
	  UM.getEditor('docContent').setDisabled('fullscreen');
	  $('#content').hide();
	  $.get('/yxt-admin/admin/docTmplate/' + id,function(data){
		  $('#form').form('load', {
			  docTitle:data.data.docTitle,
         	docDesc:data.data.docDesc,
         	docContent:data.data.docContent
		  });
		  UM.getEditor('docContent').setContent(data.data.docContent);
	  });
	  $('#dialog').dialog({
	    title: '查看详情',
	    width: 1150,
	    height: heightnum>700 ? 700 : heightnum-100,
	 	    onClose:function(){
	    	 if( um.queryCommandState( 'source' )==1){
	 	    	 um.execCommand( 'source');	 
	 	    	}
	    }
	  });	
	}

	
	
	function del(id) {
		  $.messager.confirm('确认', '您确认想要删除记录吗？',
		  function(r) {
		    if (r) {
		      $.ajax({
		        type: 'delete',
		        url: '/yxt-admin/admin/docTmplate/' + id,
		        success: function(data) {
		          if (data.stateCode == 200) {
		            $('#main_table').datagrid('reload');
		            $.messager.show({
		              title: '提示消息',
		              msg: data.message,
		              timeout: 5000,
		              showType: 'slide'
		            });
		          } else {
		            $.messager.show({
		              title: '提示',
		              msg: data.message
		            });
		          }
		        },
		        error: function(XMLHttpRequest, textStatus, errorThrown) {
		          $.messager.show({
		            title: '提示',
		            msg: '请求发生错误请联系开发者'
		          });
		        }
		      });
		    }
		  });
		}
	
	
</script> 
 </head> 
 <body class="easyui-layout" id="layout">
 <div id="west" data-options="region:'west',collapsible:false,split:false">
  <!-- 搜索栏 --> 
  <div id="seach"> 
   <label>文档标题:</label> 
   <input id="name" class="easyui-textbox" style="width: 120px;" /> 

  
    
   <a href="javascript:query()" class="easyui-linkbutton"><i class="fa fa-search"></i> 搜索</a> 
  <a href="javascript:clear()" class="easyui-linkbutton"><i class="fa fa-ban"></i> 清除搜索条件</a>
   <a href="javascript:add()" class="easyui-linkbutton"><i class="fa fa-plus"></i> 新增</a> 
    <a href="javascript:re()" class="easyui-linkbutton"><i class="fa  fa-refresh"></i> 刷新当前页面</a> 
  </div> 

  <!-- 内容表格 --> 
  <table id="main_table"> 
   <thead> 
    <tr> 
     <th data-options="field:'id',width:20">id</th> 
     <th data-options="field:'docTitle',width:30">文档标题</th> 
     <th data-options="field:'docDesc',width:25">文档描述</th> 
     <th data-options="field:'img',align:'center',width:30,formatter:_opformatter">操作</th> 
    </tr> 
   </thead> 
  </table> 

  <!-- 添加 --> 
  <div id="dialog"> 
   <form id="form" method="post"> 
    <table class="table-edit" width="100%" align="center"> 
     <tbody> 
      <tr> 
       <td style="width: 100px;">文档标题</td> 
       <td><input class="easyui-textbox" name="docTitle" id="docTitle" style="width: 200px"  data-options="required:true,validType:'length[0,45]' "/>
       </td> 
       </tr>
       <tr>
       <td style="width: 100px;">文档描述</td> 
       <td><input class="easyui-textbox" type="text"  name="docDesc"  id="docDesc" style="width: 200px;height:50px"  data-options="multiline:true,validType:'length[0,45]'"  />
       </td> 
      </tr> 
       <tr>
       <!-- <td style="width: 100px;" id="content">文档内容</td>  -->
       <td colspan="2"><script id="docContent" type="text/plain" style="width:1100px;height:300px;" name="docContent"  data-options="prompt:模板文档内容"></script></td> 
      </tr>
     </tbody> 
    </table> 
   </form> 
  </div>
  
  
  
  
  
  
  </div>
   <div data-options="region:'center'">
  <table id="_main_table"> 
   <thead> 
    <tr> 
     <th data-options="field:'id',width:90"></th> 
     <th data-options="field:'name',width:90">医生类型名称</th> 
     <th data-options="field:'code',width:90">类型编码</th> 
     <th data-options="field:'state',width:60">状态</th> 
    </tr> 
   </thead> 
  </table>
  </div>
 </body>
 <script type="text/javascript">
    //实例化编辑器
    var um = UM.getEditor('docContent');
    um.addListener('blur',function(){
        $('#focush2').html('编辑器失去焦点了')
    });
    um.addListener('focus',function(){
        $('#focush2').html('')
    });
    //按钮的操作
    function insertHtml() {
        var value = prompt('插入html代码', '');
        um.execCommand('insertHtml', value)
    }
    function isFocus(){
        alert(um.isFocus())
    }
    function doBlur(){
        um.blur()
    }
    function createEditor() {
        enableBtn();
        um = UM.getEditor('docContent');
    }
    function getAllHtml() {
        alert(UM.getEditor('docContent').getAllHtml())
    }
    function getContent() {
        var arr = [];
        arr.push("使用editor.getContent()方法可以获得编辑器的内容");
        arr.push("内容为：");
        arr.push(UM.getEditor('docContent').getContent());
        alert(arr.join("\n"));
    }
    function getPlainTxt() {
        var arr = [];
        arr.push("使用editor.getPlainTxt()方法可以获得编辑器的带格式的纯文本内容");
        arr.push("内容为：");
        arr.push(UM.getEditor('docContent').getPlainTxt());
        alert(arr.join('\n'))
    }
    function setContent(isAppendTo) {
        var arr = [];
        arr.push("使用editor.setContent('欢迎使用umeditor')方法可以设置编辑器的内容");
        UM.getEditor('docContent').setContent('欢迎使用umeditor', isAppendTo);
        alert(arr.join("\n"));
    }
    function setDisabled() {
        UM.getEditor('docContent').setDisabled('fullscreen');
        disableBtn("enable");
    }

    function setEnabled() {
        UM.getEditor('docContent').setEnabled();
        enableBtn();
    }

    function getText() {
        //当你点击按钮时编辑区域已经失去了焦点，如果直接用getText将不会得到内容，所以要在选回来，然后取得内容
        var range = UM.getEditor('docContent').selection.getRange();
        range.select();
        var txt = UM.getEditor('docContent').selection.getText();
        alert(txt)
    }

    function getContentTxt() {
        var arr = [];
        arr.push("使用editor.getContentTxt()方法可以获得编辑器的纯文本内容");
        arr.push("编辑器的纯文本内容为：");
        arr.push(UM.getEditor('docContent').getContentTxt());
        alert(arr.join("\n"));
    }
    function hasContent() {
        var arr = [];
        arr.push("使用editor.hasContents()方法判断编辑器里是否有内容");
        arr.push("判断结果为：");
        arr.push(UM.getEditor('docContent').hasContents());
        alert(arr.join("\n"));
    }
    function setFocus() {
        UM.getEditor('docContent').focus();
    }
    function deleteEditor() {
        disableBtn();
        UM.getEditor('docContent').destroy();
    }
    function disableBtn(str) {
        var div = document.getElementById('btns');
        var btns = domUtils.getElementsByTagName(div, "button");
        for (var i = 0, btn; btn = btns[i++];) {
            if (btn.id == str) {
                domUtils.removeAttributes(btn, ["disabled"]);
            } else {
                btn.setAttribute("disabled", "true");
            }
        }
    }
    function enableBtn() {
        var div = document.getElementById('btns');
        var btns = domUtils.getElementsByTagName(div, "button");
        for (var i = 0, btn; btn = btns[i++];) {
            domUtils.removeAttributes(btn, ["disabled"]);
        }
    }
</script>
</html>