<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.system.mapper.doctor.DoctorGroupMapper" >


<!-- 添加 -->
<insert id="insert" parameterType="org.system.entity.doctor.DoctorGroup" useGeneratedKeys="true" keyColumn="id">
		insert into doctor_group (name,state,create_date,remark,hospital_id,group_tel,doctor_group_type_id,group_pic) values 
		(#{name},#{state},now(),#{remark},#{hospitalId},#{groupTel},#{doctorGroupTypeId},#{groupPic})
</insert>

<!-- 查询所有 -->
<select id="queryAll" parameterType="org.system.entity.doctor.DoctorGroup" resultType="map">
   select dg.id,dg.name dgName,dg.state,dg.create_date createDate,dg.remark,h.name hospitalName,dg.group_tel groupTel, dg.group_pic groupPic,dgt.name dgtName from doctor_group  dg 
   left join hospital h on dg.hospital_id=h.id
   left join doctor_group_type dgt on dgt.id=dg.doctor_group_type_id
   <where>
      <if test="name!=null and name!=''">
       dg.name like CONCAT(CONCAT('%', #{name}), '%')
      </if>
      <if test="hospitalId!=null">
        dg.hospital_id=#{hospitalId}
      </if>     
   </where>
   
</select>


<!-- 查询单个 -->
<select id="queryOne" parameterType="org.system.entity.doctor.DoctorGroup" resultType="map">
 select dg.id,dg.name dgName,dg.state,dg.create_date createDate,dg.remark,dg.group_tel groupTel ,dg.group_pic groupPic,h.id hospitalName,dgt.id dgtName from doctor_group  dg 
    left join hospital h on dg.hospital_id=h.id 
    left join doctor_group_type dgt on dgt.id=dg.doctor_group_type_id
    where dg.id=#{id}
</select>


<!-- 修改 -->
<update id="update" parameterType="org.system.entity.doctor.DoctorGroup" >
update doctor_group 
 <set>		
		<if test="state !=null and state!=''">
			state=#{state},
		</if>
		<if test="name !=null and name!=''">
			name=#{name},
		</if>
		<if test="remark !=null and remark!=''">
			remark=#{remark},
		</if>
		<if test="hospitalId !=null and hospitalId!=''">
			hospital_id=#{hospitalId},
		</if>
		<if test="groupTel !=null and groupTel!=''">
			group_tel=#{groupTel},
		</if>
		<if test="groupPic !=null and groupPic!=''">
			group_pic=#{groupPic},
		</if>
		
		<if test="doctorGroupTypeId !=null and doctorGroupTypeId!=''">
			doctor_group_type_id=#{doctorGroupTypeId},
		</if>
		<if test="createDate!=null">
		create_date=date(#{createDate,jdbcType=TIMESTAMP})
		</if>
	</set>
	where id=#{id}
</update>

<!--检查是否存在  -->
<select id="checkExists" parameterType="org.system.entity.doctor.DoctorGroup" resultType="map">
  select name,state,remark,hospital_id,group_tel,doctor_group_type_id,group_pic from doctor_group where name=#{name} and state=#{state} and remark=#{remark} 
  and hospital_id=#{hospitalId} and group_tel=#{groupTel} and doctor_group_type_id=#{doctorGroupTypeId}
  and group_pic=#{groupPic}
</select>


<!--删除数据  -->
<delete id="delete">
delete from doctor_group where id=#{id}
</delete>


<select id="getDoctorGroupDoctorList" parameterType="org.system.entity.doctor.DoctorGroup" resultType="map">
	
  	select dg.id doctorGroupId,dg.name doctorGroupName,d.id id,d.name doctorAccount,dd.name doctorName,r.name roleName ,h.name hospitalName,dept.name deptName,t.name titleName
   from doctor_doctor_group ddg 
	  left join doctor_group dg on dg.id=ddg.doctor_group_id
    left join doctor d on d.id=ddg.doctor_id
    left join role r on ddg.role_id=r.id
    LEFT JOIN hospi_depart_doctor_relation hddr on hddr.doctor_id=d.id    
    left join doctor_detail dd on dd.doctor_id=d.id
    left join hospital h on dd.zp_hospital_id=h.id
    LEFT JOIN department dept on hddr.department_id=dept.id 
    left join title t on d.title_id =t.id 
  	where ddg.doctor_group_id=#{id}
  	GROUP BY id
</select>


<select id="getDoctorGroupDoctorListNotIn" parameterType="org.system.entity.doctor.DoctorGroup" resultType="map">
  select dg.id doctorGroupId,dg.name doctorGroupName,d.id id,d.name doctorAccount,dd.name doctorName,r.id roleId,r.name roleName ,h.name hospitalName,dept.name deptName,t.name titleName
   from doctor_doctor_group ddg left join doctor d  on  d.id not in (select doctor_id from doctor_doctor_group ddg where  ddg.doctor_group_id= #{id}) 
   left join doctor_group dg on dg.id=ddg.doctor_group_id  
     left join doctor_detail dd on dd.doctor_id=d.id
      left join role r on ddg.role_id=r.id
    LEFT JOIN hospi_depart_doctor_relation hddr on hddr.doctor_id=d.id
     LEFT JOIN hospital h on hddr.hospital_id=h.id
  LEFT JOIN department dept on hddr.department_id=dept.id 
    left join title t on d.title_id =t.id 
 	  group by id
</select>


</mapper>