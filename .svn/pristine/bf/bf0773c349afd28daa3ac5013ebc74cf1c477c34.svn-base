<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.system.mapper.order.UserOrderMapper" >
	<!-- 新增 -->
	<insert id="insert" parameterType="org.system.entity.order.UserOrder" useGeneratedKeys="true" keyProperty="order_num">
		insert into user_order(order_num,state,price,create_time,service_pack_id,user_id,hospital_id,doctor_id,evidence_sn,evidence_object_id,order_type)
		values
		(#{orderNum},#{state},#{price},#{createTime},#{servicePackId},#{userId},#{hospitalId},#{doctorId},#{evidenceSn},#{evidenceObjectId},#{orderType})
	</insert>
	
	<!-- 修改 -->
	<update id="update" parameterType="org.system.entity.order.UserOrder">
		update user_order set order_num=#{orderNum}
		<if test="state!=null">
			,state=#{state}
		</if>
		where order_num=#{orderNum}
	</update>
	
	<!-- 查询列表 -->
	<select id="queryAll" parameterType="org.system.entity.order.UserOrder" resultType="map">
	select uo.id,uo.order_num orderNum,uo.user_id userId,uo.service_pack_id servicePackId,uo.state,sp.acquisitive,
	sp.`name` packageName,uo.price,uo.create_time createTime,uo.hospital_id hospitalId,h.`name` hospitalName,
	uo.evidence_sn evidenceSn,uo.evidence_object_id evidenceObjectId,uo.order_type orderType,dd.`name` doctorName,
	ud.`name` userName,sp.package_type_id packageTypeId
	from user_order uo
	left join service_pack_condition spc on spc.id=uo.service_pack_id
	left join service_pack sp on sp.id=spc.service_pack_id
	left join hospital h on h.id=uo.hospital_id
	left join doctor_detail dd on dd.doctor_id=uo.doctor_id
	left join user_detail ud on ud.user_id=uo.user_id
	<where>
		<if test="userId !=null">
			uo.user_id=#{userId}
		</if>
		<if test="state !=null">
			and uo.state=#{state}
		</if>
		<if test="servicePack !=null">
			<if test="servicePack.packageTypeId !=null">
					and sp.package_type_id =#{servicePack.packageTypeId}
			</if>
		</if>
		<if test="orderType !=null">
			and uo.order_type=#{orderType}
		</if>
	</where>
		order by state,createTime desc
	</select>
	
	<!-- 根据主键查询单个 -->
	<select id="queryOne" parameterType="org.system.entity.order.UserOrder" resultType="map">
	select uo.id,uo.order_num orderNum,uo.user_id userId,uo.service_pack_id servicePackId,sp.package_type_id packageTypeId,
	uo.state,sp.acquisitive,sp.`name` packageName,uo.price,uo.create_time createTime,uo.hospital_id hospitalId,h.`name` hospitalName,
	uo.evidence_sn evidenceSn,uo.evidence_object_id evidenceObjectId,uo.order_type orderType,dd.`name` doctorName,ud.`name` userName
	from user_order uo
	left join service_pack_condition spc on spc.id=uo.service_pack_id
	left join service_pack sp on sp.id=spc.service_pack_id
	left join hospital h on h.id=uo.hospital_id
	left join doctor_detail dd on dd.doctor_id=uo.doctor_id
	left join user_detail ud on ud.user_id=uo.user_id
	<where>
		<if test="id!=null">
			 uo.id=#{id}
		</if>
		<if test="userId !=null">
			and uo.user_id=#{userId}
		</if>
		<if test="orderNum!=null and orderNum!=''">
			and uo.order_num=#{orderNum}
		</if>
	</where>
	</select>
	
	<!-- 根据约束键查询数据是否存在 -->
	<select id="checkExists" parameterType="org.system.entity.order.UserOrder" resultType="map">
		select order_num,user_id userId,service_pack_id servicePackId from user_order where order_num=#{orderNum}
	</select>
</mapper>