<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head> 
  <base href="/yxt-admin/" /> 
  <title>列表</title>
  <meta http-equiv="Access-Control-Allow-Origin" content="*"> 
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
   <META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
  <META HTTP-EQUIV="Cache-Control" CONTENT="no-cache"> 
   <META HTTP-EQUIV="Expires" CONTENT="0"> 
  <link rel="stylesheet" type="text/css" href="js/easyui/themes/icon.css" /> 
  <link rel="stylesheet" type="text/css" href="js/easyui/themes/gray/easyui.css" /> 
  <link rel="stylesheet" type="text/css" href="js/trumbowyg/design/css/trumbowyg.css" /> 
  <link rel="stylesheet" type="text/css" href="css/jquery.flex-images.css" /> 
  <link rel="stylesheet" type="text/css" href="css/icon/font-awesome.min.css" /> 
  <link rel="stylesheet" type="text/css" href="css/upload/webuploader.css" /> 
  <link rel="stylesheet" type="text/css" href="css/upload/style.css" /> 
  <link rel="stylesheet" type="text/css" href="css/web.css" /> 
  <link rel="stylesheet" href="/yxt-admin/webuploader/styles/default.css?ver=v1.001">
  <link rel="stylesheet" href="/yxt-admin/webuploader/styles/webuploader.css?ver=v1.001">
  <link href="/yxt-admin/umeditor1_2_2-utf8-net/themes/default/css/umeditor.css" type="text/css" rel="stylesheet">
  <script type="text/javascript" src="/yxt-admin/webuploader/scripts/jquery-1.12.1.min.js?ver=v1.001"></script>
  <script type="text/javascript" src="/yxt-admin/webuploader/scripts/webuploader.js?ver=v1.001"></script>
  <script type="text/javascript" src="/yxt-admin/webuploader/scripts/uploader.js?ver=v1.001"></script>
  <script type="text/javascript" src="js/jquery.min.js"></script> 
  <script type="text/javascript" src="js/easyui/jquery.easyui.min.js"></script> 
  <script type="text/javascript" src="js/easyui/locale/easyui-lang-zh_CN.js"></script> 
  <script type="text/javascript" src="js/easyui/extend.easyui.js"></script> 
  <script type="text/javascript" src="js/jquery.flex-images.min.js"></script> 
    <script type="text/javascript" charset="utf-8" src="/yxt-admin/umeditor1_2_2-utf8-net/umeditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="/yxt-admin/umeditor1_2_2-utf8-net/umeditor.min.js"></script>
    <script type="text/javascript" src="/yxt-admin/umeditor1_2_2-utf8-net/lang/zh-cn/zh-cn.js"></script>
  
    
  <script type="text/javascript">
  var heightnum="";
  $(function() {
	  heightnum=document.body.clientHeight;
	  /*初始化控件*/
	  $('#main_table').datagrid({
	    method: 'get',
	    url: '/yxt-admin/admin/sysAbout?ran=' + Math.random(),
	    toolbar: '#seach',
	    pagination: true,
	    fit: true,
	    pageSize:20,
	    fitColumns: true,
	    border: false,
	    rownumbers: true,
	    singleSelect: true,
	    loadFilter: function(data) {
	    	if(data.stateCode=='205'){
	    		top.location.href="/yxt-admin/admin/adminLogin.html";
	    		return;
	    	}else if(data.stateCode=='203'){
	    		return {total:0,rows:[]};
	    	}
	    	var rows = data.data.rows,rowslen = rows.length,i;
	    	for(i = 0 ; i < rowslen; ++i){
		    	rows[i].createDate = DateToString(rows[i].createDate);
	    	}
	      return data.data;
	    }
	  });
	});
  
  
  function _stateformatter(value, row, index) {
	   if (value == 'ServiceAgreement') {
	       return "服务协议";
	  }if (value == 'HealthyClassroom'){
	       return "健康讲堂";
	  }if (value == 'ContractAgreement'){
		  return "签约协议";
	  }if (value == 'ContactUs'){
		  return "关于我们";
	  }if (value == 'PolicyAdvice'){
		  return "政策咨询";
	  }
	   } 
	function query() {
	  $('#main_table').datagrid('load', {
	    title: $('#servicePack').textbox('getValue')
	  });
	}
	 function clear() {
	  $('#servicePack').textbox('clear');
	}
	 
	 function re(){
	   	  history.go(0) 
	     }
	 
	function _opformatter(value, row, index) {
	  var a = '&nbsp;<a href="javascript:edit(\'' + index + '\',' + row.id + ')" title="编辑和详情"><i class="fa fa-pencil"></i></a>';	
	 var c = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:del(\'' + row.id + '\')" title="删除"><i class="fa fa-trash"></i></a>';
	 var b = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:look(\'' + row.id + '\')" title="查看"><i class="fa fa-search-plus"></i></a>';
	  return a+b+c;
	}
	

	function add() {
		 $("#form .easyui-textbox").textbox({ disabled: false });
		  UM.getEditor('content').setEnabled();
		  $('#type').combobox({disabled:false});
		um.setContent("");
		$('#covers').html("");
		/* $('#files').html(""); */
         var imgup = new NebFiles.ImageUp({
             show: true ,
             maxnum: 1
         });
         imgup.AddTo($('#covers'));
	  /* 	// 上传文件	
         var fileup = new NebFiles.FileUp({
             show: true ,
             maxnum:1
         });                 
         // 将上传框放某标签里面
         fileup.AddTo($('#files'));	 */
	  		
/* 	$('#createDate').datetimebox('readonly',false); */
	  $('#form').form('reset');
	  $('#dialog').dialog({
		    title: '添加',
		    width:1000,
		    height: heightnum>760 ? 760 : heightnum-100,
		    closed: false,
		    modal: true,
		    buttons: [{
		      text: '确定添加',
		      handler: function() {
		     	  var v = $('#form').form('validate'); 
		     	  var arr = [];
			        arr.push(UM.getEditor('content').getPlainTxt());
			        arr=arr.join("\n");
		    	  if(v){
		    	/*   var time=$('#createDate').datetimebox('getValue');
			    	time=time.replace(/-/g,"/");
			    	var date=new Date(time); */

						                $.ajax({
									              type: 'post',
									              url: '/yxt-admin/admin/sysAbout/insert',
									              data:{
									            	  title:$('#title').textbox('getValue'),
								                	 /* createDate:date, */
								                	  type:$('#type').combobox('getValue'),
								                	  content:arr,
								                	  covers:imgup.GetImages().length==0 ? null : imgup.GetImages().toString()
								    	             /* files:fileup.GetFiles().length==0 ? null : fileup.GetFiles().toString() */
									              },
						                success: function(data) {
						                    if (data.stateCode == 200) {
						                    	 if( um.queryCommandState( 'source' )==1){
						    	  	  	 	    	 um.execCommand( 'source');
						    	  	  	 	    	 
						    	  	  	 	    	}
						                    	 
						                      $('#dialog').dialog('close');
						                      $('#main_table').datagrid('reload');
						                      $.messager.show({
						                        title: '提示消息',
						                        msg: data.message,
						                        timeout: 5000,
						                        showType: 'slide'
						                      });		                     
						                      
						                    } else {
						                      $.messager.show({
						                        title: '提示',
						                        msg: data.message
						                      });
						                    }
						                  },
						                  error: function(XMLHttpRequest, textStatus, errorThrown) {
						                    $.messager.show({
						                      title: '提示',
						                      msg: '请求发生错误请联系开发者'
						                    });
						                  }
									              
									            });

		   
		    		  
		    	  }

		    	
		        }
		      },
		    
		    
		    {
		      text: '取消关闭',
		      handler: function() {
		    	 
		 	    	 if( um.queryCommandState( 'source' )==1){
		 	 	    	 um.execCommand( 'source');	 
		 	 	    	}
		 	    
		        $('#dialog').dialog('close');
		      }
		    }],
		    onClose:function(){
		    	 if( um.queryCommandState( 'source' )==1){
		 	    	 um.execCommand( 'source');	 
		 	    	} 
		    }
		   
		  
		  
		  });
	}
	
	
	
	// 时间转化
	function DateToString(date, format) {
        if (!date) return "";
        format = format || "yyyy-MM-dd HH:mm:ss";
        switch (typeof date) {
            case "string":
                date = new Date(date.replace(/-/, "/"));
                break;
            case "number":
                date = new Date(date);
                break;
        }
        if (!date instanceof Date) return "";
        var dict = {
            "yyyy": date.getFullYear(),
            "yy": (date.getFullYear() + "").substr(2),
            "M": date.getMonth() + 1,
            "d": date.getDate(),
            "H": date.getHours(),
            "m": date.getMinutes(),
            "s": date.getSeconds(),
            "MM": ("" + (date.getMonth() + 101)).substr(1),
            "dd": ("" + (date.getDate() + 100)).substr(1),
            "HH": ("" + (date.getHours() + 100)).substr(1),
            "mm": ("" + (date.getMinutes() + 100)).substr(1),
            "ss": ("" + (date.getSeconds() + 100)).substr(1)
        };
        return format.replace(/(yyyy|yy|MM?|dd?|HH?|ss?|mm?)/g, function () {
            return dict[arguments[0]];
        });
    }

	
	
		
	// 修改
	function edit(index, id) {
		 
		  $('#covers').html("");
		/*  $('#files').html("");  */
		 $('#form').form('reset');
		 $("#form .easyui-textbox").textbox({ disabled: false });
		  UM.getEditor('content').setEnabled();
		  $('#type').combobox({disabled:false});
	    var imgup = new NebFiles.ImageUp({
            show: true ,
            maxnum:1   
        });
	    // 将上传框放某标签里面
        imgup.AddTo($('#covers'));
			/* // 显示文件	
	         var fileup = new NebFiles.FileUp({
	             show: true ,
	             maxnum:1   
	         });
	         fileup.AddTo($('#files')); */
	   $.get('/yxt-admin/admin/sysAbout/' + id,
	  function(data) {
		  data.data.createDate=DateToString(data.data.createDate);
	      $('#form').form('load', data.data);
	      UM.getEditor('content').setContent(data.data.content);
	    // 显示图片
          var pic=data.data.covers;
		  if(pic!=null && pic!=''){
	    imgup.AddImages(data.data.covers.split(","));
        imgup.AddTo($('#covers'));
		  }
		  
			/* var file=data.data.files;
			if(file!=null && file!=''){					        
	         fileup.AddFiles(data.data.files.split(","))
	         fileup.AddTo($('#files'));	
			} */
	  });
	  $('#createDate').datetimebox('readonly');
	  $('#dialog').dialog({
	    title: '修改',
	    width:1000,
	    height: heightnum>760 ? 760 :heightnum-100,
	    closed: false,
	    modal: true,
	    buttons: [{
	      text: '确定修改',
	      handler: function() {
	        var v = $('#form').form('validate');
	        var arr = [];
	        arr.push(UM.getEditor('content').getContent());
	        arr=arr.join("\n");
	    	 /*  var timee=$('#createDate').datetimebox('getValue');
		    	timee=timee.replace(/-/g,"/");
		    	var datee=new Date(timee); */
		    	
	        if (v) {
	        		 //AJAX提交
	  	          $.ajax({
	  	            type: 'put',
	  	            url: '/yxt-admin/admin/sysAbout/' + id,
	  	            data:{
	  	            	 title:$('#title').textbox('getValue'),
		            	  covers:imgup.GetImages().length==0 ? null : imgup.GetImages().toString(),
	                	/*   createDate:datee, */
	                	 /*  files:fileup.GetFiles().length==0 ? null : fileup.GetFiles().toString(), */
	                	  type:$('#type').combobox('getValue'),
	                	  content:arr
	                  },
	  	            success: function(data) {
	  	              if (data.stateCode == 200) {	  	            	 
	  	            	 if( um.queryCommandState( 'source' )==1){
	  	  	 	    	 um.execCommand( 'source');	 
	  	  	 	    	}
	  	                $('#dialog').dialog('close');
	  	                $('#form').form('reset');
	  	                $('#main_table').datagrid('reload');
	  	                $.messager.show({
	  	                  title: '提示消息',
	  	                  msg: data.message,
	  	                  timeout: 5000,
	  	                  showType: 'slide'
	  	                });
	  	              } else {
	  	                $.messager.show({
	  	                  title: '提示',
	  	                  msg: data.message
	  	                });
	  	              }
	  	            },
	  	            error: function(XMLHttpRequest, textStatus, errorThrown) {
	  	              $.messager.show({
	  	                title: '提示',
	  	                msg: '请求发生错误请联系开发者'
	  	              });
	  	            }
	  	          });        
	          
	        }

	      }
	    } ,
	    {
	      text: '取消关闭',
	      handler: function() {
	    	  if( um.queryCommandState( 'source' )==1){
	 	    	 um.execCommand( 'source');	 
	 	    	}
	        $('#dialog').dialog('close');
	      }
	    }],
	    onClose:function(){
	    	if( um.queryCommandState( 'source' )==1){
	    	 um.execCommand( 'source');	 
	    	} 
	    }
	  });
	}
	
function look(id){
	
	 $('#form').form('reset');
	  $('#covers').html("");
		/*  $('#files').html("");  */
	 $("#form .easyui-textbox").textbox({ disabled: true });
	 $('#type').combobox({disabled:true});
	  UM.getEditor('content').setDisabled('fullscreen');
   var imgup = new NebFiles.ImageUp({
      show: true ,
      maxnum:1
   });
   // 将上传框放某标签里面
   imgup.AddTo($('#covers'));
		/* // 显示文件	
        var fileup = new NebFiles.FileUp({
          //  show: true  
            maxnum:1         
        });
        fileup.AddTo($('#files')); */
  $.get('/yxt-admin/admin/sysAbout/' + id, function(data) {
	  data.data.createDate=DateToString(data.data.createDate);
     $('#form').form('load', data.data);
     UM.getEditor('content').setContent(data.data.content);
   // 显示图片
     var pic=data.data.covers;
	  if(pic!=null && pic!=''){
   imgup.AddImages(data.data.covers.split(","));
   imgup.AddTo($('#covers'));
	  }
		/* var file=data.data.files;
		if(file!=null && file!=''){					        
        fileup.AddFiles(data.data.files.split(","))
        fileup.AddTo($('#files'));	
		}  */
 });
  $('#dialog').dialog({
	    title: '查看',
	    width:1000,
	    height: heightnum>760 ? 760 : heightnum-100,
	    onClose:function(){
	    	 if( um.queryCommandState( 'source' )==1){
	 	    	 um.execCommand( 'source');	 
	 	    	}
	    } 
  });
}

	function del(id) {		
	  $.messager.confirm('确认', '您确认想要删除记录吗？',
	  function(r) {
	    if (r) {
	      $.ajax({
	        type: 'delete',
	        url: '/yxt-admin/admin/sysAbout/' + id,
	        success: function(data) {
	          if (data.stateCode == 200) {
	            $('#main_table').datagrid('reload');
	            $.messager.show({
	              title: '提示消息',
	              msg: data.message,
	              timeout: 5000,
	              showType: 'slide'
	            });
	          } else {
	            $.messager.show({
	              title: '提示',
	              msg: data.message
	            });
	          }
	        },
	        error: function(XMLHttpRequest, textStatus, errorThrown) {
	          $.messager.show({
	            title: '提示',
	            msg: '请求发生错误请联系开发者'
	          });
	        }
	      });
	    }
	  });
	}

</script> 
 </head> 
 <body> 
  <!-- 全局日历控件 --> 
  <!--  <div id="sc" class="easyui-calendar" data-options="validator: function(date){return date<=new Date();}"></div> -->
  <!-- 搜索栏 --> 
  <div id="seach"> 
   <label>产品包名称</label> 
   <input id="servicePack" class="easyui-textbox" style="width: 120px;" /> 
   <a href="javascript:query()" class="easyui-linkbutton"><i class="fa fa-search"></i> 搜索</a> 
   <a href="javascript:clear()" class="easyui-linkbutton"><i class="fa fa-ban"></i> 清除搜索条件</a> 
   <a href="javascript:add()" class="easyui-linkbutton"><i class="fa fa-plus"></i> 新增</a>
    <a href="javascript:re()" class="easyui-linkbutton"><i class="fa  fa-refresh"></i> 刷新当前页面</a>  
  </div> 
  <!-- 内容表格 --> 
  <table id="main_table"> 
   <thead> 
    <tr> 
     <th data-options="field:'id',width:20">id</th>  
      <th data-options="field:'title',width:50">标题</th> 
      <th data-options="field:'createDate',width:50">创建时间</th>
      <th data-options="field:'type',width:50,formatter:_stateformatter" >类型</th>
     <th data-options="field:'img',align:'center',width:30,formatter:_opformatter">操作</th>      
    </tr> 
   </thead> 
  </table> 
 
  
 
  
   <div id="dialog">  
   <form id="form" method="post"> 
    <table class="table-edit" width="100%" align="center"> 
     <tbody> 
      <tr> 
       <td style="width: 110px;">标题</td> 
       <td><input class="easyui-textbox" name="title"  id="title" style="width: 200px" data-options="required:true,validType:'length[0,128]',missingMessage:'标题不能为空'"/>
       </td>      
       </tr>
     <!--  <tr> 
       <td style="width: 110px;">创建时间</td> 
       <td><input class="easyui-datetimebox" name="createDate"  id="createDate"  style="width: 200px" data-options="required:true,editable:false,"/>
       </td>       
       </tr> --> 
       <tr>
       <td style="width: 110px;">类型</td> 
        <td> <select class="easyui-combobox" name="type" id="type" style="width:200px;" data-options="required:true,editable:false,panelHeight:'auto'">   
           <option value="ServiceAgreement">服务协议</option>   
		   <option value="HealthyClassroom">健康讲堂</option>
		   <option value="ContractAgreement">签约协议</option>	
		     <option value="ContactUs">关于我们</option>	
		       <option value="PolicyAdvice">政策咨询</option>		  
		    </select>   
       </td>  
       </tr>
              
     <tr>
        <td style="width: 110px;">封面 </td>
      
       <td><div id="covers"></div>   <span style="color:red"> (提示:推荐上传：60px*60px倍数的图片,支付图片格式 gif,jpg,jpeg,bmp,png)</span> </td>
       </tr>
      <!-- <tr>
        <td style="width: 110px;">文件</td> 
       <td><div id="files"></div><span style="color:red">  (提示:支持文件格式  pdf,rar,doc,docx,xls,xlsx)</span></td>
       </tr> -->
       <tr><td style="width: 100px;" colspan="2" align="center">主题内容</td></tr>
      <tr> 
     
       <td colspan="2"><script id="content" type="text/plain" style="width:950px;height:300px;" name="content" ></script></td> 
       </tr>
 
     </tbody> 
    </table> 
   </form>    
  </div> 
 </body>
 
 
  <script type="text/javascript">
    //实例化编辑器
    var um = UM.getEditor('content');
    um.addListener('blur',function(){
        $('#focush2').html('编辑器失去焦点了')
    });
    um.addListener('focus',function(){
        $('#focush2').html('')
    });
    //按钮的操作
    function insertHtml() {
        var value = prompt('插入html代码', '');
        um.execCommand('insertHtml', value)
    }
    function isFocus(){
        alert(um.isFocus())
    }
    function doBlur(){
        um.blur()
    }
    function createEditor() {
        enableBtn();
        um = UM.getEditor('content');
    }
    function getAllHtml() {
        alert(UM.getEditor('content').getAllHtml())
    }
    function getContent() {
        var arr = [];
        arr.push("使用editor.getContent()方法可以获得编辑器的内容");
        arr.push("内容为：");
        arr.push(UM.getEditor('content').getContent());
        alert(arr.join("\n"));
    }
    function getPlainTxt() {
        var arr = [];
        arr.push("使用editor.getPlainTxt()方法可以获得编辑器的带格式的纯文本内容");
        arr.push("内容为：");
        arr.push(UM.getEditor('content').getPlainTxt());
        alert(arr.join('\n'))
    }
    function setContent(isAppendTo) {
        var arr = [];
        arr.push("使用editor.setContent('欢迎使用umeditor')方法可以设置编辑器的内容");
        UM.getEditor('content').setContent('欢迎使用umeditor', isAppendTo);
        alert(arr.join("\n"));
    }
    function setDisabled() {
        UM.getEditor('content').setDisabled('fullscreen');
        disableBtn("enable");
    }

    function setEnabled() {
        UM.getEditor('content').setEnabled();
        enableBtn();
    }

    function getText() {
        //当你点击按钮时编辑区域已经失去了焦点，如果直接用getText将不会得到内容，所以要在选回来，然后取得内容
        var range = UM.getEditor('content').selection.getRange();
        range.select();
        var txt = UM.getEditor('content').selection.getText();
        alert(txt)
    }

    function getContentTxt() {
        var arr = [];
        arr.push("使用editor.getContentTxt()方法可以获得编辑器的纯文本内容");
        arr.push("编辑器的纯文本内容为：");
        arr.push(UM.getEditor('content').getContentTxt());
        alert(arr.join("\n"));
    }
    function hasContent() {
        var arr = [];
        arr.push("使用editor.hasContents()方法判断编辑器里是否有内容");
        arr.push("判断结果为：");
        arr.push(UM.getEditor('content').hasContents());
        alert(arr.join("\n"));
    }
    function setFocus() {
        UM.getEditor('content').focus();
    }
    function deleteEditor() {
        disableBtn();
        UM.getEditor('content').destroy();
    }
    function disableBtn(str) {
        var div = document.getElementById('btns');
        var btns = domUtils.getElementsByTagName(div, "button");
        for (var i = 0, btn; btn = btns[i++];) {
            if (btn.id == str) {
                domUtils.removeAttributes(btn, ["disabled"]);
            } else {
                btn.setAttribute("disabled", "true");
            }
        }
    }
    function enableBtn() {
        var div = document.getElementById('btns');
        var btns = domUtils.getElementsByTagName(div, "button");
        for (var i = 0, btn; btn = btns[i++];) {
            domUtils.removeAttributes(btn, ["disabled"]);
        }
    }
</script>
</html>