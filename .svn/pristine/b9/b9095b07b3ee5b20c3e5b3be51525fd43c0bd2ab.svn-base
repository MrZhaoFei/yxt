package org.system.controller.impl.address;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.annotation.Resource;

import org.core.result.ResultCode;
import org.core.result.ResultMap;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Controller;
import org.springframework.validation.BindingResult;
import org.system.Global;
import org.system.controller.iface.address.IAddressController;
import org.system.entity.address.Address;
import org.system.message.Message;
import org.system.service.iface.address.IAddressService;
import org.utils.calc.GeographyScope;

@Controller
public class AddressController implements IAddressController {
	Logger log = LoggerFactory.getLogger(AddressController.class);

	@Resource
	private IAddressService addressService;

	@Override
	public Map<String, Object> getAddressList(Address address, BindingResult result) {
		/*定义返回对象*/
		Map<String, Object> resultMap = new HashMap<>();
		/*得到返回数据*/
		List<Map<String, Object>> dataList = addressService.getAddressList(address);
		if (dataList != null && dataList.size() > 0) {
			/*得到数据总数*/
			resultMap.put(Global.DATA_TOTAL, address.getTotal());
			resultMap.put(Global.DATA_ROWS, dataList);
			return ResultMap.convertMap(ResultCode.CODE_SUCCESS, resultMap, Message.bundle("query.success"));
		}
		return ResultMap.convertMap(ResultCode.CODE_DATA_EMPTY, Message.bundle("query.empty"));
	}

	@Override
	public Map<String, Object> getAddressDetail(Integer addressId, Address address) {
		/*设置实例的id属性*/
		address.setId(addressId);
		/*查询详情得到返回数据*/
		Map<String, Object> resultMap = addressService.getAddressDetail(address);
		if (resultMap != null && resultMap.size() > 0) {
			return ResultMap.convertMap(ResultCode.CODE_SUCCESS, resultMap, Message.bundle("query.success"));
		}
		return ResultMap.convertMap(ResultCode.CODE_DATA_EMPTY, Message.bundle("query.empty"));
	}

	@Override
	public Map<String, Object> getAddressChildListByRaidus(Integer type, Address address, BindingResult result) {
		/*定义参数集合，设置参数*/
		Map<String, Object> param = GeographyScope.getAround(address.getLatitude(), address.getLongitude(),
				address.getRaidus());
		param.put("type", type);
		param.put("hospitalId", address.getHospitalId());
		/*得到返回数据*/
		List<Map<String, Object>> dataList = addressService.getAddressListByRaidus(param);
		if (dataList != null && dataList.size() > 0) {
			return ResultMap.convertMap(ResultCode.CODE_SUCCESS, dataList, Message.bundle("query.success"));
		}
		return ResultMap.convertMap(ResultCode.CODE_DATA_EMPTY, Message.bundle("query.empty"));
	}
}
